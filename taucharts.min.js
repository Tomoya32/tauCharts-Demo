!function(){var t=function(){};t.new=function(t,e){function n(){return t.apply(this,e)}return n.prototype=t.prototype,new n},t.extend=function(t){function e(){!a&&this.init&&this.init.apply(this,arguments)}var n=this.prototype,a=!0,i=new this;a=!1;for(var r in t)i[r]="function"==typeof t[r]&&"function"==typeof n[r]?function(t,e){return function(){var a=this._super;this._super=n[t];var i=e.apply(this,arguments);return this._super=a,i}}(r,t[r]):t[r];return e.prototype=i,e.prototype.constructor=e,e.extend=arguments.callee,e},window.Class=t,window.tau={}}(),function(){var t=Class.extend({init:function(t){this._plugins=t},_call:function(t,e){for(var n=0;n<this._plugins.length;n++)"function"==typeof this._plugins[n][t]&&this._plugins[n][t].apply(this._plugins[n],e)},render:function(){this._call("render",arguments)},click:function(){this._call("click",arguments)},mouseover:function(){this._call("mouseover",arguments)},mouseout:function(){this._call("mouseout",arguments)}}),e=Class.extend({init:function(t){this._dataSource=t},map:function(t){return this._mapper=tau.data.Mapper(t),this},plugins:function(){return this._plugins=new t(arguments),this},render:function(){throw new Error("Not implemented")}}),n={padding:10},a=Class.extend({init:function(t){this._mapper=t},render:function(){}}),i=a.extend({render:function(t){var e=d3.svg.axis().scale(this._mapper._scale).orient("bottom");t.append("g").attr("class","x axis").attr("transform","translate(0, "+n.padding+")").call(e).append("text").attr("class","label").attr("x",t.layout("width")).attr("y",-e.tickSize()).style("text-anchor","end").text(this._mapper.caption())}}),r=a.extend({render:function(t){var e=d3.svg.axis().scale(this._mapper._scale).orient("left");t.append("g").attr("class","y axis").attr("transform","translate(-"+n.padding+", 0)").call(e).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",e.tickSize()).attr("y",e.tickSize()+t.layout("width")).attr("dy",".71em").style("text-anchor","end").text(this._mapper.caption()),t.selectAll(".tick line").attr("x1",t.layout("width")-6).attr("x2",t.layout("width")),t.selectAll(".tick text").attr("dx",t.layout("width")),t.select(".domain").attr("transform","translate("+t.layout("width")+", 0)")}}),s=Class.extend({init:function(t,e){this._mapperX=t,this._mapperY=e},render:function(t){var e=d3.svg.axis().scale(this._mapperX._scale).orient("bottom").tickSize(t.layout("height")),n=d3.svg.axis().scale(this._mapperY._scale).orient("left").tickSize(-t.layout("width")),a=t.insert("g",":first-child").attr("class","grid");a.append("g").call(e),a.append("g").call(n),a.selectAll("text").remove()}}),o={top:20,right:20,bottom:30,left:40},l='<div class="html html-left"></div><svg></svg><div class="html html-right"></div><div class="html html-above"></div><div class="html html-below"></div>',c=Class.extend({init:function(t){var e=d3.select(t).classed("tau-chart",!0).html(l);this.html={left:e.select(".html-left"),right:e.select(".html-right"),above:e.select(".html-above"),below:e.select(".html-below")},this.svg=tau.svg.paddedBox(e.select("svg"),o);var n=new tau.svg.Layout(this.svg);n.row(-30),this.yAxis=n.col(20),this.data=n.col(),n.row(),n.col(20),this.xAxis=n.col(),this.width=this.data.layout("width"),this.height=this.data.layout("height")}}),u=function(t){return function(){this.on("click",function(e){t.click(new m(e),new p(d3.select(this)))}).on("mouseover",function(e){t.mouseover(new m(e),new p(d3.select(this)))}).on("mouseout",function(e){t.mouseout(new m(e),new p(d3.select(this)))})}},d=e.extend({init:function(t){this._super.call(this,t)},_renderData:function(){throw new Error("Not implemented")},render:function(t){var e=new c(t);this._mapper.binder("x").range([0,e.width]),this._mapper.binder("y").range([e.height,0]),this._dataSource.get(function(t){this._mapper.binder("x").domain([0,d3.max(t,this._mapper.raw("x"))]),this._mapper.binder("y").domain([0,d3.max(t,this._mapper.raw("y"))]);var n=function(t){this._renderData(e.data,t),e.data.selectAll(".i-role-datum").call(u(this._plugins))}.bind(this);n(t),this._dataSource.update(n),new r(this._mapper.binder("y")).render(e.yAxis),new i(this._mapper.binder("x")).render(e.xAxis),new s(this._mapper.binder("x"),this._mapper.binder("y")).render(e.data),tau.svg.bringOnTop(e.data),this._plugins.render(new f(this._dataSource),new h(e,this._mapper))}.bind(this))}}),h=Class.extend({init:function(t,e){this.svg=t.svg,this.html=t.html,this.mapper=e},elements:function(){return this.svg.selectAll(".i-role-datum")}}),p=Class.extend({init:function(t){this.element=t}}),f=Class.extend({init:function(t){this.data=t}}),m=Class.extend({init:function(t){this.datum=t}});tau.charts={Base:d,add:function(t,e){tau.charts[t]=e}}}(),function(){var t=function(t,e,n){return t[e]=n,t},e=function(e,n){return t({},e,n)},n=function(){},a=function(t,e){return function(){t.apply(t,arguments),e.apply(e,arguments)}},i=Class.extend({init:function(){this._observers={update:n}},get:function(){throw new Error("not implemented")},filter:function(){throw new Error("not implemented")},update:function(t){this._on("update",t)},_on:function(t,e){this._observers[t]=a(this._observers[t],e)},_trigger:function(t,e){this._observers[t](e)}}),r=i.extend({init:function(t){this._data=t,this._super()},get:function(t){t(this._predicate?this._data.filter(this._predicate):this._data)},filter:function(t){this._predicate=t,this._trigger("update",this._predicate?this._data.filter(this._predicate):this._data)}}),s=Class.extend({init:function(t){this._propertyMappers=t},binder:function(t){return this._propertyMappers[t]},domain:function(t){return this.binder(t).domain()},_bind:function(t,e,n){var a=/%[^%]*%/g;return a.test(t)?function(i){return t.replace(a,function(t){var a=t.substr(1,t.length-2);return e.call(n,a,i)})}:function(a){return e.call(n,t,a)}},map:function(t){return this._bind(t,function(t,e){return this.binder(t).map(e)},this)},raw:function(t){return this._bind(t,function(t,e){return this.binder(t).raw(e)},this)},alias:function(t,e){this._propertyMappers[t].alias(e)}}),o=Class.extend({init:function(t){this._names=[t],this._caption=t,this._scale=d3.scale.linear()},alias:function(t){this._names.push(t)},raw:function(t){return t[this._names.filter(function(e){return t.hasOwnProperty(e)})[0]]},map:function(t){return this._scale(this.raw(t))},linear:function(){return this._scale=d3.scale.linear(),this},domain:function(){return arguments.length?this._scale.domain.apply(this._scale.domain,arguments):this._scale.domain().map(e.bind(null,this._names[0]))},category10:function(){return this._scale=d3.scale.ordinal().range(["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"]),this},range:function(){return this._scale.range.apply(this._scale,arguments),this},caption:function(t){return t?(this._caption=t,this):this._caption}}),l=Class.extend({init:function(t){this._value=t},raw:function(){return this._value},map:function(){return this._value},domain:function(){},range:function(){throw new Error("range is not implemented for constants")},caption:function(){throw new Error("caption is not implemented for constants")}});tau.data={Array:function(t){return new r(t)},Mapper:function(t){function e(){var e={};for(var n in t){var a=t[n];"string"==typeof a&&(a=new o(a)),e[n]=a}return e}return new s(e())},map:function(t){return new o(t)},constant:function(t){return new l(t)},identity:function(t){return t}}}(),function(){var t=Class.extend({init:function(){},render:function(){},click:function(){},mouseover:function(){},mouseout:function(){}});tau.plugins={add:function(e,n){n=t.extend(n),tau.plugins[e]=function(){return Class.new(n,arguments)}}}}(),function(){function t(t,e){return t>0?t:e+t}var e=Class.extend({init:function(t,e){this._svg=t,e?(this._width=e.width,this._height=e.height):(this._width=t.layout("width"),this._height=t.layout("height")),this._x=0,this._y=0,this._translateX=0,this._translateY=0},_translate:function(t){(this._translateX||this._translateY)&&t.attr("transform","translate("+(this._translateX||0)+","+(this._translateY||0)+")")},_extend:function(e){var n={width:t(this._x-this._translateX,this._width),height:t(this._y-this._translateY,this._height)};e.layout=function(t){return n[t]}},row:function(e){this._translateX=0,this._translateY=this._y,this._y=e?this._y+t(e-this._y,this._height):null},col:function(e){return this._translateX=this._x,this._x=e?this._x+t(e-this._x,this._width):null,this._svg.append("g").call(this._translate.bind(this)).call(this._extend.bind(this))}}),n=function(t){t.node().parentNode.appendChild(t.node())},a=function(t,e){var n=t[e].baseVal;switch(n.unitType){case 1:return n.value;case 2:return(t.parentNode[e]||t.parentNode.getBoundingClientRect()[e])*n.valueInSpecifiedUnits/100;default:throw new Error("unitType "+n.unitType+" is not supported")}},i=function(t){return{width:a(t,"width"),height:a(t,"height")}},r=function(t,e){var n=new tau.svg.Layout(t,i(t.node()));return n.row(e.top),n.row(-e.bottom),n.col(e.left),n.col(-e.right)};tau.svg={getBBox:i,bringOnTop:n,paddedBox:r,Layout:e}}(),function(){var t=tau.charts.Base.extend({map:function(t){return this._super(t),this._mapper.alias("color","key"),this},_renderData:function(t,e){var n=this._mapper,a=d3.nest().key(n.raw("color")).entries(e),i=function(){this.attr("class",n.map("line %color%"));var t=this.selectAll("path").data(function(t){return[t.values]});t.call(s),t.enter().append("path").call(s),t.exit().remove();var e=this.selectAll(".dot").data(function(t){return t.values});e.call(o),e.enter().append("circle").attr("class","dot i-role-datum").call(o),e.exit().remove()},r=d3.svg.line().interpolate("cardinal").x(n.map("x")).y(n.map("y")),s=function(){this.attr("d",r)},o=function(){return this.attr("cx",n.map("x")).attr("cy",n.map("y")).attr("r",function(){return 3})},l=t.selectAll(".line").data(a);l.call(i),l.enter().append("g").call(i),l.exit().remove()}});tau.charts.add("Line",function(e){return new t(e)})}(),function(){var t=tau.charts.Base.extend({_renderData:function(t,e){this._mapper.binder("size").domain(d3.extent(e,this._mapper.raw("size")));var n=this._mapper,a=function(){return this.attr("class",n.map("dot i-role-datum %color%")).attr("r",n.map("size")).attr("cx",n.map("x")).attr("cy",n.map("y"))},i=t.selectAll(".dot").data(e);i.call(a),i.enter().append("circle").call(a),i.exit().remove()}});tau.charts.add("Scatterplot",function(e){return new t(e)})}(),function(){var t={render:function(t,e){var n=e.html.right.append("div").attr("class","datatable");n.append("a").attr("href","#").html("Show data table").on("click",function(){i(),r(n),d3.event.preventDefault()});var a=n.append("div"),i=function(){var e=a.append("table"),n=e.append("thead"),r=e.append("tbody"),s=Object.keys(t.data._data[0]);e.attr("class",function(){return"col-"+s.length}),n.selectAll("th").data(s).enter().append("th").text(tau.data.identity);var o=r.selectAll("tr").data(t.data._data).enter().append("tr");o.selectAll("td").data(function(t){return d3.values(t)}).enter().append("td").text(function(t){return t}),i=function(){}},r=function(t){"datatable"==t.attr("class")?t.attr("class","datatable show"):t.attr("class","datatable")}}};tau.plugins.add("datatable",t)}(),function(){var t={mouseover:function(t,e){e.element.classed("highlighted",!0)},mouseout:function(t,e){e.element.classed("highlighted",!1)}};tau.plugins.add("highlighter",t)}(),function(){function t(t){return function(e){return t!=e}}var e={render:function(e,n){var a=(n.svg.layout("width"),n.mapper.domain("color")),i=[],r=n.html.right.append("ul").attr("class","legend"),s=r.selectAll("li").data(a).enter().append("li");s.attr("class",n.mapper.map("color")).on("click",function(a){var r=n.mapper.raw("color")(a);-1==i.indexOf(r)?(i.push(r),d3.select(this).classed("disabled",!0)):(i=i.filter(t(r)),d3.select(this).classed("disabled",!1)),e.data.filter(function(t){return-1==i.indexOf(n.mapper.raw("color")(t))})}).on("mouseover",function(t){var e=n.mapper.raw("color")(t);n.elements().classed("highlighted",function(t){return n.mapper.raw("color")(t)===e})}).on("mouseout",function(){n.elements().classed("highlighted",!1)}),s.text(n.mapper.raw("color"))}};tau.plugins.add("legend",e)}(),function(){var t={init:function(){this._axises=0===arguments.length?["x","y"]:Array.prototype.slice.call(arguments,0)},render:function(t,e){var n=20,a=30,i=10,r=(e.svg.layout("width"),e.svg.layout("height")),s=e.mapper,o=this._axises;this.mouseover=function(t){var l=e.svg.selectAll(".projections").data([t.datum]).enter().append("g").attr("transform","translate("+n+", 0)").attr("class",s.map("color")).classed("projections",!0);o.indexOf("x")>-1&&(l.append("g").attr("class","y").append("line").attr("x1",s.map("x")).attr("y1",r-a+i).attr("x2",s.map("x")).attr("y2",s.map("y")),l.select(".y").append("text").attr("transform","translate(0, 18)").attr("dx",s.map("x")).attr("dy",r-a+10).text(s.raw("x"))),o.indexOf("y")>-1&&(l.append("g").attr("class","x").append("line").attr("x1",0).attr("y1",s.map("y")).attr("x2",s.map("x")).attr("y2",s.map("y")),l.select(".x").append("text").attr("transform","translate(-19, 4)").attr("dx",0).attr("dy",s.map("y")).text(s.raw("y")))},this.mouseout=function(){e.svg.selectAll(".projections").remove()}}};tau.plugins.add("projection",t)}(),function(){var t={init:function(){this._dataFields=arguments,this._container=d3.select("body").append("div")},mouseover:function(t){for(var e="",n=this._dataFields.length-1;n>=0;n--){var a=this._dataFields[n];e+='<p class="tooltip-'+a+'"><em>'+a+":</em> "+t.datum[a]+"</p>"}this._container.classed("tooltip",!0).style("top",d3.mouse(this._container[0].parentNode)[1]-10+"px").style("left",d3.mouse(this._container[0].parentNode)[0]+10+"px").style("display","block").html(e)},mouseout:function(){this._container.style("display","none")}};tau.plugins.add("tooltip",t)}();