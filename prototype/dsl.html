<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
    <script src="../libs/d3.js"></script>

    <!-- src -->
    <script src="../src/class.js"></script>
    <script src="../src/tau.data.js"></script>
    <script src="../src/tau.data.types.js"></script>
    <script src="../src/tau.svg.js"></script>
    <script src="../src/tau.charts.js"></script>
    <script src="../src/charts/line.js"></script>
    <script src="../src/charts/scatterplot.js"></script>
    <script src="../src/charts/bar.js"></script>
    <script src="../src/tau.plugins.js"></script>

    <!-- plugins -->
    <script src="../plugins/tooltip.js"></script>
    <script src="../plugins/legend.js"></script>
    <script src="../plugins/highlighter.js"></script>
    <script src="../plugins/projection.js"></script>
    <script src="../plugins/datatable.js"></script>
    <script src="../plugins/header.js"></script>
    <script src="../plugins/trend.js"></script>
    <script src="../plugins/jittering.js"></script>

    <!-- test data -->
    <script src="data.js"></script>

    <script src="countries.js"></script>
    <script src="tpStories.js"></script>

    <!-- css -->
    <link href="../css/default.css" rel="stylesheet"/>
    <link href="../css/oldschool.css" rel="stylesheet"/>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext' rel='stylesheet'
          type='text/css'>
</head>
<body>

<div id="chartScatter" style="width:800px;height:600px;display:inline-block;margin:160px 30px;"> <!-- Magic margin--></div>

<script>

    var def = {

        dimensions: {
            GDP: 'Gdp',
            HPNS: 'Happiness',
            CNTRY: 'Country'
        },

        coords: {
            type: 'RECT',
            axes: [
                { axis: 'GDP', label: '<h4>GDP</h4><p>points</p>' },
                { axis: 'HPNS', label: '<h4>Happiness</h4><p>points</p>' }
            ],
            unit: [
                {
                    type: 'POINT',
                    color: 'CNTRY',
                    size: null,
                    shape: null,
                    position: [
                        'GDP',
                        'HPNS'
                    ]
                }
            ]
        }
    };

    var DSLReader = function (ast) {
        this.ast = ast;
    };

    DSLReader.prototype = {

        process: function (rawData) {

            var data = tau.data.Array(rawData);

            var DIMS = this.ast.dimensions;
            var COORDS = this.ast.coords;
            var axes = COORDS.axes;
            var xmap = {};

            var X = axes[0];
            xmap.x = tau.data.map(DIMS[X.axis]);
            if (X.label) {
                xmap.x = xmap.x.caption(X.label);
            }

            var Y = axes[1];
            xmap.y = tau.data.map(DIMS[Y.axis]);
            if (Y.label) {
                xmap.y = xmap.y.caption(Y.label);
            }

            xmap.color = DIMS[COORDS.unit[0].color];

            tau.charts.Scatterplot(data).map(xmap).render("#chartScatter");
        }
    };

    // RECT(DIM(GDP, HPNS), POINT({ x: GPR, y: HPNS, color: CNTRY }))
    var reader = new DSLReader(def);
    reader.process(window.countries);

</script>
</body>
</html>