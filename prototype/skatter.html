<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.js"></script>

    <!-- src -->
    <script src="../src/class.js"></script>
    <script src="../src/tau.data.js"></script>
    <script src="../src/tau.data.types.js"></script>
    <script src="../src/tau.svg.js"></script>
    <script src="../src/tau.charts.js"></script>
    <script src="../src/charts/line.js"></script>
    <script src="../src/charts/scatterplot.js"></script>
    <script src="../src/charts/bar.js"></script>
    <script src="../src/tau.plugins.js"></script>

    <!-- plugins -->
    <script src="../plugins/tooltip.js"></script>
    <script src="../plugins/legend.js"></script>
    <script src="../plugins/highlighter.js"></script>
    <script src="../plugins/projection.js"></script>
    <script src="../plugins/datatable.js"></script>
    <script src="../plugins/header.js"></script>
    <script src="../plugins/trend.js"></script>
    <script src="../plugins/jittering.js"></script>

    <!-- test data -->
    <script src="data.js"></script>

    <script src="countries.js"></script>
    <script src="tpStories.js"></script>

    <script src="../libs/traceur.js"></script>
    <script src="../libs/es6-module-loader.js"></script>
    <!-- css -->
    <link href="../css/default.css" rel="stylesheet"/>
    <link href="../css/oldschool.css" rel="stylesheet"/>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext' rel='stylesheet'
          type='text/css'>
    <style>
        .axes.nest .axis.nest text {
            font-size: 10px;
        }

        .tau-chart {
            padding: 20px;
            width: 640px;
            height: 640px;
        }
        input {
            width: 500px;
        }
        .blue {
            stroke: blue;
            fill: blue;
        }
        .green {
            stroke: green;
            fill: green;
        }
        .red {
            stroke: red;
            fill: red;
        }
    </style>
    <title></title>
</head>
<body>
<div style="float: left;padding: 20px">
    <label for="data">data</label><br/>
    <textarea  style='width:600px;height: 350px'  id="data"></textarea>
</div>
<div style="float: left; padding: 20px">
    <label>x<input id="x" type="text"/></label><br/><br/>
    <label>y <input id="y" type="text"/></label><br/><br/>
    <label> color <input id="color" type="text"/></label><br/><br/>
    "String" or <a id="colorSettings">"{dimension: 'team',domain: ['d', 'k', 'l'],range: ['red', 'green', 'blue']}"</a>
    <br/><br/>
    <label >size <input id="size" type="text"/></label><br/><br/>
</div>
<br style="clear: both;"/>

<button id="update">Update chart</button>
<br/><br/>
<div id="chart-container" class="tau-chart" style="display:inline-block;margin:0;border: solid 1px;"></div>
<script>
    System.baseURL = '/tauCharts/src/';
    System.import('tau.newCharts').then(function (m) {
        var defData = [
            {team: 'd', cycleTime: 1, effort: 1, count: 1, priority: 'low'},
            {team: 'd', cycleTime: 3, effort: 6, count: 5, priority: 'low'},
            {team: 'd', cycleTime: 4, effort: 7, count: 21, priority: 'medium'},
            {team: 'k', cycleTime: 5, effort: 8, count: 2, priority: 'medium'},
            {team: 'd', cycleTime: 2, effort: 2.5, count: 3, priority: 'high'},
            {team: 'l', cycleTime: 2.2, effort: 4, count: 5, priority: 'high'}

        ];
        function getFieldData($field) {
            try {
               return JSON.parse($field.val())
            } catch(e) {
                return $field.val();
            }

        }
        var $color = $('#color').val('team');
        var $size = $('#size').val('effort');
        var $y = $('#y').val('cycleTime');
        var $x = $('#x').val('effort');
        var $data = $('#data').val(JSON.stringify(defData));
        $('#colorSettings').click(function(){
           return $color.val(JSON.stringify({dimension: 'team',domain: ['d', 'k', 'l'],range: ['red', 'green', 'blue']}))
        });
        $('#update').click(function(){
            drawChart();
        });
        drawChart();
        function drawChart() {
            $('#chart-container').empty();
            var chart = new m.tauChart.Scatterplot({
                container: '#chart-container',
                width: 600,
                height: 600,
                data: JSON.parse($data.val()),
                plugins: [tau.plugins.tooltip('team', 'effort', 'team','count'), tau.plugins.highlighter()],
                x: getFieldData($x),
                y: getFieldData($y),
                color: getFieldData($color),
                size: getFieldData($size)
            });
        }

    })
</script>
</body>
</html>