/*! tauCharts - v0.0.1 - 2014-10-14
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(a):"object"==typeof module&&module.exports?module.exports=a():this.tauChart=a()}(function(){function a(a){return a?{scaleDim:a}:null}var b={clone:function(a){return JSON.parse(JSON.stringify(a))}},c=function(){var a=function(a,b){var c,d=_.toArray(arguments);c=_.isArray(d[0])?d[0]:_.times(a,function(){return _.times(b,function(){return null})}),this.cube=c};return a.prototype={iterate:function(a){var b=this.cube;return _.each(b,function(b,c){_.each(b,function(b,d){a(c,d,b)})}),this},getRC:function(a,b){return this.cube[a][b]},setRC:function(a,b,c){return this.cube[a][b]=c,this},sizeR:function(){return this.cube.length},sizeC:function(){var a=this.cube[0]||[];return a.length}},a}(),d=function(){var a={CROSS:function(a,b,c){var d=a.domain(b),e=a.domain(c).reverse();return _(e).map(function(a){return _(d).map(function(d){var e={};return b&&(e[b]=d),c&&(e[c]=a),e})})}},d=function(b){return a[b]||function(){return[[{}]]}},e={"COORDS.RECT":function(a,e){var f=_.defaults(a,{$where:{}});f.x=_.isObject(f.x)?f.x:{scaleDim:f.x},f.y=_.isObject(f.y)?f.y:{scaleDim:f.y};var g=_.any(f.unit,function(a){return 0===a.type.indexOf("COORDS.")}),h=d(g?"CROSS":""),i=new c(h(f,f.x.scaleDim,f.y.scaleDim)),j=new c(i.sizeR(),i.sizeC());return i.iterate(function(a,c,d){var e=_.extend({},f.$where,d),g=_(f.unit).map(function(a){return _.extend(_.defaults(b.clone(a),{x:f.x.scaleDim,y:f.y.scaleDim}),{$where:e})});j.setRC(a,c,g)}),f.$matrix=j,j.iterate(function(a,b,c){_.each(c,function(a){return e(a)})}),f}};return function(a){return e[a]||function(a){return a}}}(),e=function(){var a=function(a,b){return"translate("+a+","+b+")"},b=function(a){return"rotate("+a+")"},c=function(a){return _.contains(["bottom","top"],a.toLowerCase())?"h":"v"},d=function(d,e){var f=this;if(d.scaleDim){var g=d3.svg.axis().scale(d.scale).orient(d.guide.scaleOrient),h=f.append("g").attr("class",d.guide.cssClass).attr("transform",a.apply(null,e)).call(g);h.selectAll(".tick text").attr("transform",b(d.guide.rotate)).style("text-anchor",d.guide.textAnchor),"h"===c(d.guide.scaleOrient)?h.append("text").attr("transform",b(d.guide.label.rotate)).attr("class","label").attr("x",.5*d.guide.size).attr("y",d.guide.label.padding).style("text-anchor",d.guide.label.textAnchor).text(d.guide.label.text):h.append("text").attr("transform",b(d.guide.label.rotate)).attr("class","label").attr("x",.5*-d.guide.size).attr("y",-d.guide.label.padding).style("text-anchor",d.guide.label.textAnchor).text(d.guide.label.text)}},e=function(b,c,d){var e=this,f=e.append("g").attr("class","grid").attr("transform",a(0,0)),g=(b.guide.showGridLines||"").toLowerCase();if(g.length>0){var h=f.append("g").attr("class","grid-lines");if(g.indexOf("x")>-1&&b.x.scaleDim){var i=b.x,j=d3.svg.axis().scale(i.scale).orient(b.guide.x.scaleOrient).tickSize(c);h.append("g").call(j)}if(g.indexOf("y")>-1&&b.y.scaleDim){var k=b.y,l=d3.svg.axis().scale(k.scale).orient(b.guide.y.scaleOrient).tickSize(-d);h.append("g").call(l)}h.selectAll("text").remove()}return f},f={"COORDS.RECT":function(b,c){var f=b.options,g=b.guide.padding;b.x.guide=b.guide.x,b.y.guide=b.guide.y;var h=f.left+g.l,i=f.top+g.t,j=f.width-(g.l+g.r),k=f.height-(g.t+g.b);b.x.scale=b.x.scaleDim&&b.scaleTo(b.x,[0,j]),b.y.scale=b.y.scaleDim&&b.scaleTo(b.y,[k,0]),b.x.guide.size=j,b.y.guide.size=k;var l=[0,k+b.guide.x.padding],m=[0-b.guide.y.padding,0],n=f.container.append("g").attr("class","cell").attr("transform",a(h,i));b.x.guide.hide||d.call(n,b.x,l),b.y.guide.hide||d.call(n,b.y,m);var o=e.call(n,b,k,j);b.$matrix.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:o},a.options),c(a)})})},"ELEMENT.POINT":function(a){var b=a.partition(),c=a.source(),d=["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"],e=function(){return _(c).chain().pluck(a.color).uniq().value()},f=a.options||{};f.xScale=a.scaleTo(a.x,[0,f.width]),f.yScale=a.scaleTo(a.y,[f.height,0]);var g,h,i;i=a.color,_.isObject(a.color)?(g=a.color.range||d,h=a.color.domain||e(),i=a.color.dimension):(g=d,h=e());var j=d3.scale.ordinal().range(g).domain(h),k=_.max([f.width,f.height]),l=_(c).chain().pluck(a.size).map(function(a){return parseInt(a,10)}),m=d3.scale.linear().range([k/200,k/100]).domain([l.min().value(),l.max().value()]),n=function(){return this.attr("r",function(b){var c=m(b[a.size]);return _.isFinite(c)||(c=k/100),c}).attr("class",function(a){return"dot i-role-datum "+j(a[i])}).attr("cx",function(b){return f.xScale(b[a.x])}).attr("cy",function(b){return f.yScale(b[a.y])})},o=f.container.selectAll(".dot").data(b);o.call(n),o.exit().remove(),o.enter().append("circle").call(n)},"ELEMENT.INTERVAL":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=function(){return this.attr("class","i-role-datum  bar").attr("x",function(c){return b.xScale(c[a.x])}).attr("width",b.xScale.rangeBand()).attr("y",function(c){return b.yScale(c[a.y])}).attr("height",function(c){return b.height-b.yScale(c[a.y])})},d=b.container.selectAll(".bar").data(a.partition());d.call(c),d.enter().append("rect").call(c),d.exit().remove()},"ELEMENT.LINE":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=d3.svg.line().x(function(c){return b.xScale(c[a.x])}).y(function(c){return b.yScale(c[a.y])});b.container.append("g").attr("class","line").attr("stroke","#4daf4a").append("path").datum(a.partition()).attr("d",c)},"WRAP.AXIS":function(b,c){var e=b.options,f=b.guide.padding;b.x.guide=b.guide.x,b.y.guide=b.guide.y;var g=e.left+f.l,h=e.top+f.t,i=e.width-(f.l+f.r),j=e.height-(f.t+f.b);b.x.guide.size=i,b.y.guide.size=j,b.x.scale=b.x.scaleDim&&b.scaleTo(b.x,[0,i]),b.y.scale=b.y.scaleDim&&b.scaleTo(b.y,[j,0]);var k=[0,j+b.guide.x.padding],l=[0-b.guide.y.padding,0],m=e.container.append("g").attr("class","axis-container").attr("transform",a(g,h));e.showX&&!b.x.guide.hide&&d.call(m,b.x,k),e.showY&&!b.y.guide.hide&&d.call(m,b.y,l);{var n=m.append("g").attr("class","sub-axis-container").attr("transform",a(0,0)),o=b.$axes.sizeR();b.$axes.sizeC()}b.$axes.iterate(function(a,b,d){(0===b||a===o-1)&&d.forEach(function(a){a.options=_.extend({container:n},a.options||{}),a.$axes&&c(a)})})},"WRAP.MULTI_AXES":function(b,c){var d=b.options,e=b.guide.padding,f=d.left+e.l,g=d.top+e.t,h=(d.width-(e.l+e.r),d.height-(e.t+e.b),d.container.append("g").attr("class","cell-wrapper").attr("transform",a(f,g)));b.$axes.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:h},a.options),c(a)})}),b.$matrix.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:h},a.options),c(a)})})},"WRAP.MULTI_GRID":function(b,c){var d=b.options,e=b.guide.padding,f=d.left+e.l,g=d.top+e.t,h=d.container.append("g").attr("class","grid-wrapper").attr("transform",a(f,g));b.$matrix.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:h},a.options),c(a)})})}};return function(a){if(!f.hasOwnProperty(a))throw new Error("Unknown unit type: "+a);return f[a]}}(),f={ordinal:function(a){return a},linear:function(a){return d3.extent(a)}},g=function(a){return"ordinal"===a?"rangeRoundBands":"rangeRound"},h=function(){"use strict";function a(a,b){var c=this;this.fnSource=function(a){return _(b).where(a||{})},this.fnDomain=function(a){return _(b).chain().pluck(a).uniq().value()},this.fnScaleTo=function(b,d){var e=_.isString(b)?{scaleDim:b}:b,h=_.defaults(e,a[e.scaleDim]),i=h.scaleType,j=c.fnDomain(h.scaleDim),k=g(i),l=f[i](j);return d3.scale[i]().domain(l)[k](d,.1)}}var b=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),c=Object.getOwnPropertyDescriptor,d=function(a,d){for(var e in d)d.hasOwnProperty(e)&&b(a,e,c(d,e));return a},e={};return b(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.mix=function(a){return a.source=this.fnSource,a.domain=this.fnDomain,a.scaleTo=this.fnScaleTo,a.partition=function(){return a.source(a.$where)},a},d(a.prototype,e),e=void 0,a}(),i=function(){"use strict";function a(a,c){this.spec=b.clone(a),this.domain=new h(this.spec.dimensions,c)}var c=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),f=Object.getOwnPropertyDescriptor,g=function(a,b){for(var d in b)b.hasOwnProperty(d)&&c(a,d,f(b,d));return a},i={};return c(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),i.buildGraph=function(){var a=this,b=function(c){return d(c.type)(a.domain.mix(c),b)};return b(this.spec.unit)},i.calcLayout=function(a,b,c){return a.options={top:0,left:0,width:c.width,height:c.height},b(a,this.domain)},i.renderGraph=function(a,b){var c=this;a.options.container=b;var d=function(a){return e(a.type)(c.domain.mix(a),d)};return d(a),a.options.container},g(a.prototype,i),i=void 0,a}(),j=this,k=function(a){return a.options=a.options||{},a.guide=a.guide||{},a.guide.padding=_.defaults(a.guide.padding||{},{l:0,b:0,r:0,t:0}),a.guide.x=_.defaults(a.guide.x||{},{label:"",padding:0,cssClass:"x axis",scaleOrient:"bottom",rotate:0,textAnchor:"middle"}),a.guide.x.label=_.isObject(a.guide.x.label)?a.guide.x.label:{text:a.guide.x.label},a.guide.x.label=_.defaults(a.guide.x.label,{padding:32,rotate:0,textAnchor:"middle"}),a.guide.y=_.defaults(a.guide.y||{},{label:"",padding:0,cssClass:"y axis",scaleOrient:"left",rotate:0,textAnchor:"end"}),a.guide.y.label=_.isObject(a.guide.y.label)?a.guide.y.label:{text:a.guide.y.label},a.guide.y.label=_.defaults(a.guide.y.label,{padding:32,rotate:-90,textAnchor:"middle"}),a},l=function(a){var b=function(a){var c=k(a);if(!c.$matrix)return c;var d,e=c.options,f=c.guide.padding,g=e.width-(f.l+f.r),h=e.height-(f.t+f.b),i=c.$matrix.sizeR(),j=c.$matrix.sizeC(),l=g/j,m=h/i;return d=c.guide.split?{calcHeight:function(a,b,c,d){return a/d},calcTop:function(a,b,c,d){return(b+1)*(a/d)*c}}:{calcHeight:function(a){return a},calcTop:function(a,b){return b*m}},c.$matrix.iterate(function(a,c,e){var f=e.length;_.each(e,function(e,g){e.options={width:l,left:c*l,height:d.calcHeight(m,a,g,f),top:d.calcTop(m,a,g,f)},b(e)})}),c};return b(a)},m={DEFAULT:l,"EXTRACT-AXES":function(a,d){var e=function(a){var e=function(a,d){var f=k(a);_.each([f.guide.x||{},f.guide.y||{}],function(a){return a.hide=!0});var g=f.$matrix.sizeR(),h=f.$matrix.sizeC();return d.$axes=new c(g,h),f.$matrix.iterate(function(a,c,f){var h=[];d.$axes.setRC(a,c,h);var i=0===c,j=a===g-1;f.forEach(function(a){var c=k(a);if(c.$matrix){var d=_.extend(b.clone(_.omit(c,"$matrix")),{type:"WRAP.AXIS"});h.push(d),c.guide.padding.l=0,c.guide.padding.b=0,d.guide.padding.l=i?d.guide.padding.l:0,d.guide.padding.b=j?d.guide.padding.b:0,e(c,d)}})}),f},f=k({type:"WRAP.MULTI_AXES",options:b.clone(a.options),x:{},y:{},$matrix:new c([[[a]]])});return e(d.mix(f),f),f.$matrix=new c([[[k({type:"WRAP.MULTI_GRID",x:{},y:{},$matrix:new c([[[a]]])})]]]),f},f=function(a){var b=function(a){var c=a.options,d=a.guide.padding,e=c.width-(d.l+d.r),f=c.height-(d.t+d.b),g=a.$axes.sizeR(),h=a.$axes.sizeC(),i=k(a.$axes.getRC(g-1,0)[0]||{}),j=i.guide.padding.l,l=i.guide.padding.b,m=e-j,n=f-l,o=m/h,p=n/g;return a.$axes.iterate(function(a,c,d){var e=0===c,f=a===g-1;(e||f)&&d.forEach(function(d){d.options={showX:f,showY:e,width:o+(e?j:0),height:p+(f?l:0),top:a*p,left:c*o+(e?0:j)},d.$axes&&b(d)})}),a};b(a);var c=0,e=0,f=function(a){var b=a.guide.padding,d=a.$axes.sizeR();return a.$axes.iterate(function(a,g,h){0===g&&a===d-1&&(c+=b.l,e+=b.b,h.forEach(function(a){return f(a)}))}),a};f(a);var g=a.options.width-c,h=a.options.height-e,i=a.$matrix.getRC(0,0)[0];return i.options={top:0,left:c,width:g,height:h},l(i,d),a};return f(e(a))}},n={get:function(a){return(m[a]||m.DEFAULT).bind(j)}},o=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),p=Object.getOwnPropertyDescriptor,q=function(a,b){for(var c in b)b.hasOwnProperty(c)&&o(a,c,p(b,c));return a},r=function(){"use strict";function a(a){this._plugins=a}var b={};return o(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b._call=function(a,b){for(var c=0;c<this._plugins.length;c++)"function"==typeof this._plugins[c][a]&&this._plugins[c][a].apply(this._plugins[c],b)},b.render=function(){this._call("render",arguments)},b.click=function(){this._call("click",arguments)},b.mouseover=function(){this._call("mouseover",arguments)},b.mouseout=function(){this._call("mouseout",arguments)},b.mousemove=function(){this._call("mousemove",arguments)},q(a.prototype,b),b=void 0,a}(),s=function(a){return function(){this.on("click",function(b){a.click(new u(b),new t(d3.select(this)))}).on("mouseover",function(b){a.mouseover(new u(b),new t(d3.select(this)))}).on("mouseout",function(b){a.mouseout(new u(b),new t(d3.select(this)))}).on("mousemove",function(b){a.mousemove(new u(b),new t(d3.select(this)))})}},t=function(){"use strict";function a(a){this.element=a}return o(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),u=(function(){"use strict";function a(a){this.data=a}return o(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),function(){"use strict";function a(a){this.datum=a}return o(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}()),v=(function(){"use strict";function a(a,b){this.svg=a.svg,this.html=a.html,this.mapper=b}var b={};return o(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.elements=function(){return this.svg.selectAll(".i-role-datum")},q(a.prototype,b),b=void 0,a}(),function(){"use strict";function a(a){var b=this.convertConfig(a);b.spec.dimensions||(b.spec.dimensions=this._autoDetectDimensions(b.data)),this.config=_.defaults(b,{spec:null,data:[],plugins:[]}),this.plugins=this.config.plugins,this.spec=this.config.spec,this.data=this.config.data,this.reader=new i(this.spec,this.data),this.graph=this.reader.buildGraph(),this._plugins=new r(this.config.plugins)}var b=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),c=Object.getOwnPropertyDescriptor,d=function(a,d){for(var e in d)d.hasOwnProperty(e)&&b(a,e,c(d,e));return a},e={};return b(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.renderTo=function(a,b){var c=b||{},d=d3.select(a),e=c.hasOwnProperty("height")?c.height:d.offsetHeight,f=c.hasOwnProperty("width")?c.width:d.offsetWidth,g=this.reader.calcLayout(this.graph,n.get(this.config.layoutEngine||"EXTRACT-AXES"),{width:f,height:e}),h=this.reader.renderGraph(g,d.append("svg").style("border","solid 1px").attr("width",f).attr("height",e));h.selectAll(".i-role-datum").call(s(this._plugins))},e._autoDetectDimensions=function(a){function b(a){return _.isNumber(a)?"linear":"ordinal"}return _.reduce(a,function(a,c){return _.each(c,function(c,d){a[d]?a[d].scaleType=a[d].scaleType==b(c)?b(c):"ordinal":a[d]={scaleType:b(c)}}),a},{})},e.convertConfig=function(a){return a},d(a.prototype,e),e=void 0,a}()),w=function(b){"use strict";function c(){b.apply(this,arguments)}var d=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),e=Object.defineProperty,f=Object.getOwnPropertyDescriptor,g=function(a,b){for(var c in b)b.hasOwnProperty(c)&&e(a,c,f(b,c));return a},h=Object.setPrototypeOf||function(a,b){return d?a.__proto__=b:e(a,"__proto__",{value:b,configurable:!0,enumerable:!1,writable:!0}),a},i=Object.create;d||g(c,b),null!==b&&h(c,b),c.prototype=i(null!==b?b.prototype:null,{constructor:{value:c,configurable:!0,writable:!0}}),e(c,"prototype",{configurable:!1,enumerable:!1,writable:!1});var j={};return j.convertConfig=function(b){var c=_.omit(b,"spec");return c.spec={dimensions:b.dimensions,unit:{type:"COORDS.RECT",x:a(b.x),y:a(b.y),guide:b.guide||{padding:{l:54,b:24,r:24,t:24},showGridLines:"xy",x:{label:b.x},y:{label:b.y}},unit:[{type:"ELEMENT.POINT",x:b.x,y:b.y,color:b.color,size:b.size}]}},c},g(c.prototype,j),j=void 0,c}(v),x={Chart:v,Scatterplot:w,__api__:{UnitDomainMixin:h,DSLReader:i,LayoutEngineFactory:n}};return x});