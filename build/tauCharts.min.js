/*! tauCharts - v0.0.1 - 2014-10-03
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(a):"object"==typeof module&&module.exports?module.exports=a():this.tauChart=a()}(function(){var a=function(){var a=function(a,b){var c,d=_.toArray(arguments);c=_.isArray(d[0])?d[0]:_.times(a,function(){return _.times(b,function(){return null})}),this.cube=c};return a.prototype={iterate:function(a){var b=this.cube;return _.each(b,function(b,c){_.each(b,function(b,d){a(c,d,b)})}),this},getRC:function(a,b){return this.cube[a][b]},setRC:function(a,b,c){return this.cube[a][b]=c,this},sizeR:function(){return this.cube.length},sizeC:function(){var a=this.cube[0]||[];return a.length}},a}(),b=function(){var b=function(a,b){return function(c){return c[a]===b}},c={CROSS:function(a,c,d){var e=a.domain(c),f=a.domain(d).reverse();return _(f).map(function(a){return _(e).map(function(e){return[b(c,e),b(d,a)]})})}},d=[],e={"COORDS/RECT":function(b,e){var f=_.defaults(b,{$filter:d});f.padding=_.defaults(f.padding||{},{L:0,B:0,R:0,T:0}),f.axes=_(f.axes).map(function(a,b){return _.defaults(a||{},{scaleOrient:0===b?"bottom":"left",padding:0})});var g=c[f.func]||function(){return[[d]]},h=new a(g(f,f.axes[0].scaleDim,f.axes[1].scaleDim)),i=new a(h.sizeR(),h.sizeC());return h.iterate(function(a,b,c){var d=f.$filter.concat(c),e=_(f.unit).map(function(a){return _.extend({},a,{$filter:d})});i.setRC(a,b,e)}),f.$matrix=i,i.iterate(function(a,b,c){_.each(c,function(a){return e(a)})}),f}};return e["COORDS.RECT"]=e["COORDS/RECT"],function(a){return e[a]||function(a){return a.padding=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),a}}}(),c=function(){var a=function(a,b){return"translate("+a+","+b+")"},b=function(a){return"ordinal"===a?"rangeRoundBands":"rangeRound"},c=function(b,c,d){var e=this;b.scaleDim&&e.append("g").attr("class",d).attr("transform",a.apply(null,c)).call(d3.svg.axis().scale(b.scale).orient(b.scaleOrient))},d=function(b,c,d){var e=this,f=e.append("g").attr("class","grid").attr("transform",a(0,0)),g=(b.showGridLines||"").toLowerCase();if(g.length>0){var h=f.append("g").attr("class","grid-lines");if(g.indexOf("x")>-1&&b.axes[0]){var i=b.axes[0],j=d3.svg.axis().scale(i.scale).orient(i.scaleOrient).tickSize(c);h.append("g").call(j)}if(g.indexOf("y")>-1&&b.axes[1]){var k=b.axes[1],l=d3.svg.axis().scale(k.scale).orient(k.scaleOrient).tickSize(-d);h.append("g").call(l)}h.selectAll("text").remove()}return f},e=function(a){var b=a.$matrix.cube[0];return b&&b[0]&&b[0][0].axes&&b[0][0].axes[0]&&b[0][0].axes[0].bubble?{$scales:b[0][0].$scales,axes:b[0][0].axes}:{axes:[]}},f=function(a,c,d,e,f){c.append("g").attr("class","axes nest");var g=a,h=_.chain(d).map(function(a){return a[e.x]}).unique().value(),i=_.chain(d).map(function(a){return a[e.y]}).unique().value(),j=g.axes[0],k=g.$scales[j.scaleDim][b(j.scaleType)]([0,f.width-2*f.paddingX],.1);c.selectAll(".x.axis.nest").data(h).enter().append("g").attr("class","x axis nest").attr("transform",function(a,b){return"translate("+(b*f.width+f.paddingY)+","+f.containerHeight+")"}).each(function(){d3.select(this).call(d3.svg.axis().scale(k).orient("bottom"))});var l=g.axes[1],m=g.$scales[l.scaleDim][b(l.scaleType)]([f.height-2*f.paddingY,0],.1);c.selectAll(".y.axis.nest").data(i).enter().append("g").attr("class","y axis nest").attr("transform",function(a,b){return"translate(0,"+(b*f.height+f.paddingY/2)+")"}).each(function(){d3.select(this).call(d3.svg.axis().scale(m).orient("left"))})},g={"COORDS/RECT":function(c,d){var g=c.options||{},h=c.axes,i=_.defaults(h[0]||{},{scaleOrient:"bottom"}),j=_.defaults(h[1]||{},{scaleOrient:"left"}),k=36,l=18,m=5,n=5,o=e(c),p=o.axes.length;i.bubble===!0&&j.bubble===!0?(k=m,l=n):p&&(k=56,l=30);var q,r=g.width-2*k,s=g.height-2*l,t=g.container.append("g").attr("class","cell").attr("transform",a(g.left+k,g.top+l/2));if(i.scaleDim&&(q=c.$scales[i.scaleDim][b(i.scaleType)]([0,r],.1),i.bubble!==!0)){var u=d3.svg.axis().scale(q).orient(i.scaleOrient);t.append("g").attr("class","x axis nest").attr("transform",a(0,s+25)).call(u)}var v;if(j.scaleDim&&(v=c.$scales[j.scaleDim][b(j.scaleType)]([s,0],.1),j.bubble!==!0)){var w=d3.svg.axis().scale(v).orient(j.scaleOrient);t.append("g").attr("class","y axis").attr("transform",a(-25,0)).call(w)}if(c.showGrid){var x=t.insert("g",":first-child").attr("class","grids");if(q){var y=d3.svg.axis().scale(q).orient(i.scaleOrient).tickSize(s);x.append("g").call(y)}if(v){var z=d3.svg.axis().scale(v).orient(j.scaleOrient).tickSize(-r);x.append("g").call(z)}x.selectAll("text").remove()}var A=t.append("g").attr("class","grid").attr("transform",a(0,0)),B=c.$matrix.sizeR(),C=c.$matrix.sizeC(),D=r/C,E=s/B;p&&f(o,t,c.partition(),{x:i.scaleDim,y:j.scaleDim},{width:D,height:E,containerHeight:s,paddingX:m,paddingY:n}),c.$matrix.iterate(function(a,b,c){c.forEach(function(c){c.options={container:A,width:D,height:E,top:a*E,left:b*D,xScale:q,yScale:v},d(c)})})},"COORDS.RECT":function(b,e){var f=b.options||{},g=_(b.axes).map(function(a,b){var c=_.isArray(a)?a:[a];return c[0]=_.defaults(c[0]||{},{scaleOrient:0===b?"bottom":"left",padding:0}),c}),h=g[0][0],i=g[1][0],j=_.defaults(b.padding||{},{L:0,B:0,R:0,T:0}),k=f.left+j.L,l=f.top+j.T,m=f.width-(j.L+j.R),n=f.height-(j.T+j.B),o=h.scaleDim&&b.scaleTo(h,[0,m]),p=i.scaleDim&&b.scaleTo(i,[n,0]);g[0][0].scale=o,g[1][0].scale=p;var q=[0,n+h.padding],r=[0-i.padding,0],s=f.container.append("g").attr("class","cell").attr("transform",a(k,l));h.hide||c.call(s,h,q,"x axis"),i.hide||c.call(s,i,r,"y axis");var t=d.call(s,b,n,m);b.$matrix.iterate(function(a,b,c){c.forEach(function(a){a.options=_.extend({container:t},a.options||{}),e(a)})})},"ELEMENT/POINT":function(a){var b=a.partition(),c=a.source(),d=a.options||{};d.xScale=a.scaleTo(a.x,[0,d.width]),d.yScale=a.scaleTo(a.y,[d.height,0]);var e=d3.scale.ordinal().range(["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"]).domain(_(c).chain().pluck(a.color).uniq().value()),f=d3.scale.linear().range([0,d.width/100]).domain([0,_(c).chain().pluck(a.size).max().value()]),g=function(){return this.attr("r",function(b){var c=f(b[a.size]);return _.isNaN(c)&&(c=d.width/100),c}).attr("class",function(b){return"dot i-role-datum "+e(b[a.color])}).attr("cx",function(b){return d.xScale(b[a.x])}).attr("cy",function(b){return d.yScale(b[a.y])})},h=d.container.selectAll(".dot").data(b);h.call(g),h.exit().remove(),h.enter().append("circle").call(g)},"ELEMENT/INTERVAL":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=function(){return this.attr("class","i-role-datum  bar").attr("x",function(c){return b.xScale(c[a.x])}).attr("width",b.xScale.rangeBand()).attr("y",function(c){return b.yScale(c[a.y])}).attr("height",function(c){return b.height-b.yScale(c[a.y])})},d=b.container.selectAll(".bar").data(a.partition());d.call(c),d.enter().append("rect").call(c),d.exit().remove()},"ELEMENT/LINE":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=d3.svg.line().x(function(c){return b.xScale(c[a.x])}).y(function(c){return b.yScale(c[a.y])});b.container.append("g").attr("class","line").attr("stroke","#4daf4a").append("path").datum(a.partition()).attr("d",c)},"WRAP.MULTI_AXES":function(b,e){var f=b.options||{},g=b.padding,h=_(b.x).filter(function(a){return a.length>0}).reverse(),i=_(b.y).filter(function(a){return a.length>0}).reverse(),j=f.left+g.L,k=f.top+g.T,l=f.width-(g.L+g.R),m=f.height-(g.T+g.B),n=f.container.append("g").attr("class","cell-wrapper").attr("transform",a(j,k)),o=36;_(h).each(function(a,d){var e=d,f=l/a.length;_(a).each(function(a,d){var g=[f*d,m+e*o];a.scale=a.scaleDim?b.scaleTo(a.scaleDim,[0,f]):null,c.call(n,a,g,"x axis")})}),_(i).each(function(a,d){var e=d,f=m/a.length;_(a).each(function(a,d){var g=[0-e*o,f*d];a.scale=a.scaleDim?b.scaleTo(a.scaleDim,[f,0]):null,c.call(n,a,g,"y axis")})});var p=d.call(n,b,m,l);b.$matrix.iterate(function(a,b,c){c.forEach(function(a){a.options=_.extend({container:p},a.options||{}),e(a)})})}};return g["COORDS/RECT"]=g["COORDS.RECT"],function(a){if(!g.hasOwnProperty(a))throw new Error("Unknown unit type: "+a);return g[a]}}(),d={ordinal:function(a){return a},linear:function(a){return d3.extent(a)}},e=function(a){return"ordinal"===a?"rangeRoundBands":"rangeRound"},f=function(a,b){return _.every(a,function(a){return a(b)})},g=function(a,b,c){return a.source=function(a){return _(c).filter(a||function(){return!0})},a.partition=function(){return a.source(f.bind(null,a.$filter))},a.domain=function(a){return _(c).chain().pluck(a).uniq().value()},a.scaleTo=function(c,f){var g=_.isString(c)?{scaleDim:c}:c,h=_.defaults(g,b[g.scaleDim]),i=h.scaleType,j=a.domain(h.scaleDim);return d3.scale[i]().domain(d[i](j))[e(i)](f,.1)},a},h=function(a){this.ast=a};h.prototype={traverse:function(c,d){var e=this.ast.dimensions,f=function(a,b){return 0===b},h=function(a){return 0===a},i=function(b){var d=function(a,b){if(!a.$matrix)return a;a.skipForcePadding||(a.padding={L:0,B:0,R:0,T:0}),_.each(a.axes,function(a){return a.hide=!0});var c=[],e=[];return b.x.push(c),b.y.push(e),a.$matrix.iterate(function(a,g,i){i.forEach(function(i){0===a&&0===g&&(b.padding.L+=i.padding.L,b.padding.B+=i.padding.B);var j=_.extend({},i.padding);i.axes&&h(a,g)&&c.push(_.extend({space:j},i.axes[0])),i.axes&&f(a,g)&&e.push(_.extend({space:j},i.axes[1])),d(i,b)})}),a},i={type:"WRAP.MULTI_AXES",options:_.extend({},b.options),axes:[],padding:{L:0,R:0,T:0,B:0},skipForcePadding:!0,x:[],y:[],$matrix:new a([[[b]]])};return d(g(i,e,c),i)},j=d||function(a){if(!a.$matrix)return a;var b=a.options||{},c=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),d=b.width-(c.L+c.R),e=b.height-(c.T+c.B),f=a.$matrix.sizeR(),g=a.$matrix.sizeC(),h=d/g,i=e/f;return a.$matrix.iterate(function(a,b,c){c.forEach(function(c){c.options={width:h,height:i,top:a*i,left:b*h},j(c)})}),a},k=function(a){return b(a.type)(g(a,e,c),k)},l=this.ast.unit;return l.options={width:this.ast.W,height:this.ast.H,top:0,left:0},j(i(k(l)))},traverseToNode:function(a){this.container=d3.select(this.ast.container).append("svg").style("border","solid 1px").attr("width",this.ast.W).attr("height",this.ast.H),a.options.container=this.container;var b=function(a){return c(a.type)(a,b)};return b(a),a.options.container}};var i=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),j=Object.getOwnPropertyDescriptor,k=function(a,b){for(var c in b)b.hasOwnProperty(c)&&i(a,c,j(b,c));return a},l=function(){"use strict";function a(a){this._plugins=a}var b={};return i(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b._call=function(a,b){for(var c=0;c<this._plugins.length;c++)"function"==typeof this._plugins[c][a]&&this._plugins[c][a].apply(this._plugins[c],b)},b.render=function(){this._call("render",arguments)},b.click=function(){this._call("click",arguments)},b.mouseover=function(){this._call("mouseover",arguments)},b.mouseout=function(){this._call("mouseout",arguments)},b.mousemove=function(){this._call("mousemove",arguments)},k(a.prototype,b),b=void 0,a}(),m=function(a){return function(){this.on("click",function(b){a.click(new o(b),new n(d3.select(this)))}).on("mouseover",function(b){a.mouseover(new o(b),new n(d3.select(this)))}).on("mouseout",function(b){a.mouseout(new o(b),new n(d3.select(this)))}).on("mousemove",function(b){a.mousemove(new o(b),new n(d3.select(this)))})}},n=function(){"use strict";function a(a){this.element=a}return i(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),o=(function(){"use strict";function a(a){this.data=a}return i(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),function(){"use strict";function a(a){this.datum=a}return i(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}()),p=(function(){"use strict";function a(a,b){this.svg=a.svg,this.html=a.html,this.mapper=b}var b={};return i(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.elements=function(){return this.svg.selectAll(".i-role-datum")},k(a.prototype,b),b=void 0,a}(),function(){"use strict";function a(a){this.config=_.defaults(a,{spec:null,data:[],plugins:[]}),this.plugins=this.config.plugins,this.spec=this.config.spec,this.data=this.config.data,this.reader=new h(this.spec);var b=this._render(this.reader.traverse(this.data));this._chart=b.node(),this._plugins=new l(this.config.plugins),b.selectAll(".i-role-datum").call(m(this._plugins))}var b=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),c=Object.getOwnPropertyDescriptor,d=function(a,d){for(var e in d)d.hasOwnProperty(e)&&b(a,e,c(d,e));return a},e={};return b(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e._render=function(a){return this.reader.traverseToNode(a,this.data)},e.getSvg=function(){return this._chart},d(a.prototype,e),e=void 0,a}()),q={Chart:p};return q});