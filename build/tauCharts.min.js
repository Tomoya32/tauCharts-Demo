/*! tauCharts - v0.0.1 - 2014-10-07
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(a):"object"==typeof module&&module.exports?module.exports=a():this.tauChart=a()}(function(){function a(a){return a?{scaleDim:a}:null}var b=function(){var a=function(a,b){var c,d=_.toArray(arguments);c=_.isArray(d[0])?d[0]:_.times(a,function(){return _.times(b,function(){return null})}),this.cube=c};return a.prototype={iterate:function(a){var b=this.cube;return _.each(b,function(b,c){_.each(b,function(b,d){a(c,d,b)})}),this},getRC:function(a,b){return this.cube[a][b]},setRC:function(a,b,c){return this.cube[a][b]=c,this},sizeR:function(){return this.cube.length},sizeC:function(){var a=this.cube[0]||[];return a.length}},a}(),c=function(){var a=function(a,b){return function(c){return c[a]===b}},c=function(a){return JSON.parse(JSON.stringify(a))},d={CROSS:function(b,c,d){var e=b.domain(c),f=b.domain(d).reverse();return _(f).map(function(b){return _(e).map(function(e){return[a(c,e),a(d,b)]})})}},e=[],f={"COORDS.RECT":function(a,f){var g=_.defaults(a,{$filter:e});g.padding=_.defaults(g.padding||{},{L:0,B:0,R:0,T:0}),g.axes=_(g.axes).map(function(a,b){return _.defaults(a||{},{scaleOrient:0===b?"bottom":"left",padding:0})});var h=d[g.func]||function(){return[[e]]},i=new b(h(g,g.axes[0].scaleDim,g.axes[1].scaleDim)),j=new b(i.sizeR(),i.sizeC());return i.iterate(function(a,b,d){var e=g.$filter.concat(d),f=_(g.unit).map(function(a){return _.extend(c(a),{$filter:e})});j.setRC(a,b,f)}),g.$matrix=j,j.iterate(function(a,b,c){_.each(c,function(a){return f(a)})}),g}};return function(a){return f[a]||function(a){return a.padding=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),a}}}(),d=function(){var a=function(a,b){return"translate("+a+","+b+")"},b=function(b,c,d){var e=this;b.scaleDim&&e.append("g").attr("class",d).attr("transform",a.apply(null,c)).call(d3.svg.axis().scale(b.scale).orient(b.scaleOrient))},c=function(b,c,d){var e=this,f=e.append("g").attr("class","grid").attr("transform",a(0,0)),g=(b.showGridLines||"").toLowerCase();if(g.length>0){var h=f.append("g").attr("class","grid-lines");if(g.indexOf("x")>-1&&b.axes[0]){var i=b.axes[0],j=d3.svg.axis().scale(i.scale).orient(i.scaleOrient).tickSize(c);h.append("g").call(j)}if(g.indexOf("y")>-1&&b.axes[1]){var k=b.axes[1],l=d3.svg.axis().scale(k.scale).orient(k.scaleOrient).tickSize(-d);h.append("g").call(l)}h.selectAll("text").remove()}return f},d={"COORDS.RECT":function(d,e){var f=d.options||{},g=_(d.axes).map(function(a,b){var c=_.isArray(a)?a:[a];return c[0]=_.defaults(c[0]||{},{scaleOrient:0===b?"bottom":"left",padding:0}),c}),h=g[0][0],i=g[1][0],j=_.defaults(d.padding||{},{L:0,B:0,R:0,T:0}),k=f.left+j.L,l=f.top+j.T,m=f.width-(j.L+j.R),n=f.height-(j.T+j.B),o=h.scaleDim&&d.scaleTo(h,[0,m]),p=i.scaleDim&&d.scaleTo(i,[n,0]);g[0][0].scale=o,g[1][0].scale=p;var q=[0,n+h.padding],r=[0-i.padding,0],s=f.container.append("g").attr("class","cell").attr("transform",a(k,l));h.hide||b.call(s,h,q,"x axis"),i.hide||b.call(s,i,r,"y axis");var t=c.call(s,d,n,m);d.$matrix.iterate(function(a,b,c){c.forEach(function(a){a.options=_.extend({container:t},a.options||{}),e(a)})})},"ELEMENT.POINT":function(a){var b=a.partition(),c=a.source(),d=a.options||{};d.xScale=a.scaleTo(a.x,[0,d.width]),d.yScale=a.scaleTo(a.y,[d.height,0]);var e=d3.scale.ordinal().range(["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"]).domain(_(c).chain().pluck(a.color).uniq().value()),f=d3.scale.linear().range([0,d.width/100]).domain([0,_(c).chain().pluck(a.size).max().value()]),g=function(){return this.attr("r",function(b){var c=f(b[a.size]);return _.isNaN(c)&&(c=d.width/100),c}).attr("class",function(b){return"dot i-role-datum "+e(b[a.color])}).attr("cx",function(b){return d.xScale(b[a.x])}).attr("cy",function(b){return d.yScale(b[a.y])})},h=d.container.selectAll(".dot").data(b);h.call(g),h.exit().remove(),h.enter().append("circle").call(g)},"ELEMENT.INTERVAL":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=function(){return this.attr("class","i-role-datum  bar").attr("x",function(c){return b.xScale(c[a.x])}).attr("width",b.xScale.rangeBand()).attr("y",function(c){return b.yScale(c[a.y])}).attr("height",function(c){return b.height-b.yScale(c[a.y])})},d=b.container.selectAll(".bar").data(a.partition());d.call(c),d.enter().append("rect").call(c),d.exit().remove()},"ELEMENT.LINE":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=d3.svg.line().x(function(c){return b.xScale(c[a.x])}).y(function(c){return b.yScale(c[a.y])});b.container.append("g").attr("class","line").attr("stroke","#4daf4a").append("path").datum(a.partition()).attr("d",c)},"WRAP.AXIS":function(c,d){var e=c.options||{},f=_(c.axes).map(function(a,b){var c=_.isArray(a)?a:[a];return c[0]=_.defaults(c[0]||{},{scaleOrient:0===b?"bottom":"left",padding:0}),c}),g=f[0][0],h=f[1][0],i=_.defaults(c.padding||{},{L:0,B:0,R:0,T:0}),j=e.left+i.L,k=e.top+i.T,l=e.width-(i.L+i.R),m=e.height-(i.T+i.B),n=g.scaleDim&&c.scaleTo(g,[0,l]),o=h.scaleDim&&c.scaleTo(h,[m,0]);f[0][0].scale=n,f[1][0].scale=o;var p=[0,m+g.padding],q=[0-h.padding,0],r=e.container.append("g").attr("class","axis-container").attr("transform",a(j,k));e.showX&&!g.hide&&b.call(r,g,p,"x axis"),e.showY&&!h.hide&&b.call(r,h,q,"y axis");{var s=r.append("g").attr("class","sub-axis-container").attr("transform",a(0,0)),t=c.$axes.sizeR();c.$axes.sizeC()}c.$axes.iterate(function(a,b,c){(0===b||a===t-1)&&c.forEach(function(a){a.options=_.extend({container:s},a.options||{}),a.$axes&&d(a)})})},"WRAP.MULTI_AXES":function(b,c){var d=b.options||{},e=b.padding,f=d.left+e.L,g=d.top+e.T,h=(d.width-(e.L+e.R),d.height-(e.T+e.B),d.container.append("g").attr("class","cell-wrapper").attr("transform",a(f,g)));b.$axes.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:h},a.options||{}),c(a)})}),b.$matrix.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:h},a.options||{}),c(a)})})},"WRAP.MULTI_GRID":function(b,c){var d=b.options||{},e=b.padding,f=d.left+e.L,g=d.top+e.T,h=d.container.append("g").attr("class","grid-wrapper").attr("transform",a(f,g));b.$matrix.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:h},a.options||{}),c(a)})})}};return function(a){if(!d.hasOwnProperty(a))throw new Error("Unknown unit type: "+a);return d[a]}}(),e={ordinal:function(a){return a},linear:function(a){return d3.extent(a)}},f=function(a){return"ordinal"===a?"rangeRoundBands":"rangeRound"},g=function(a,b){return _.every(a,function(a){return a(b)})},h=function(a,b,c){return a.source=function(a){return _(c).filter(a||function(){return!0})},a.partition=function(){return a.source(g.bind(null,a.$filter))},a.domain=function(a){return _(c).chain().pluck(a).uniq().value()},a.scaleTo=function(c,d){var g=_.isString(c)?{scaleDim:c}:c,h=_.defaults(g,b[g.scaleDim]),i=h.scaleType,j=a.domain(h.scaleDim);return d3.scale[i]().domain(e[i](j))[f(i)](d,.1)},a},i=function(a){var b=_.omit(a,"$matrix");return JSON.parse(JSON.stringify(b))},j=function(a){this.ast=a};j.prototype={traverse:function(a,d){var e=this.ast.dimensions,f=function(a){var b=function(a){if(!a.$axes)return a;var c=a.options||{},d=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),e=c.width-(d.L+d.R),f=c.height-(d.T+d.B),g=a.$axes.sizeR(),h=a.$axes.sizeC(),i=a.$axes.getRC(g-1,0)[0]||{padding:{L:0,T:0,R:0,B:0}},j=i.padding.L,k=i.padding.B,l=e-j,m=f-k,n=l/h,o=m/g;return a.$axes.iterate(function(a,c,d){var e=0===c,f=a===g-1;(e||f)&&d.forEach(function(d){d.options={showX:f,showY:e,width:n+(e?j:0),height:o+(f?k:0),top:a*o,left:c*n+(e?0:j)},d.$axes&&b(d)})}),a};b(a);var c=0,d=0,e=function(a){if(!a.$axes)return a;var b=a.padding,f=a.$axes.sizeR();return a.$axes.iterate(function(a,g,h){0===g&&a===f-1&&(c+=b.L,d+=b.B,h.forEach(function(a){return e(a)}))}),a};e(a);var f=a.options.width-c,g=a.options.height-d,h=a.$matrix.getRC(0,0)[0];return h.options={top:0,left:c,width:f,height:g},j(h),a},g=function(c){var d=function(a,c){if(!a.$matrix)return a;_.each(a.axes,function(a){return a.hide=!0});var e=a.$matrix.sizeR(),f=a.$matrix.sizeC();return c.$axes=new b(e,f),a.$matrix.iterate(function(a,b,f){var g=[];c.$axes.setRC(a,b,g);var h=0===b,j=a===e-1;f.forEach(function(a){if(a.$matrix){var b=_.extend(i(a),{type:"WRAP.AXIS"});g.push(b),a.padding.L=0,a.padding.B=0,b.padding.L=h?b.padding.L:0,b.padding.B=j?b.padding.B:0,d(a,b)}})}),a},f={type:"WRAP.MULTI_AXES",padding:{L:0,R:0,T:0,B:0},options:i(c.options),$matrix:new b([[[c]]])};return d(h(f,e,a),f),f.$matrix=new b([[[{type:"WRAP.MULTI_GRID",padding:{L:0,R:0,T:0,B:0},options:{},$matrix:new b([[[c]]])}]]]),f},j=d||function(a){if(!a.$matrix)return a;var b=a.options||{},c=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),d=b.width-(c.L+c.R),e=b.height-(c.T+c.B),f=a.$matrix.sizeR(),g=a.$matrix.sizeC(),h=d/g,i=e/f;return a.$matrix.iterate(function(a,b,c){c.forEach(function(c){c.options={width:h,height:i,top:a*i,left:b*h},j(c)})}),a},k=function(b){return c(b.type)(h(b,e,a),k)},l=this.ast.unit;return l.options={width:this.ast.W,height:this.ast.H,top:0,left:0},f(g(k(l)))},traverseToNode:function(a,b){var c=this.ast.dimensions;this.container=d3.select(this.ast.container).append("svg").style("border","solid 1px").attr("width",this.ast.W).attr("height",this.ast.H),a.options.container=this.container;var e=function(a){return d(a.type)(h(a,c,b),e)};return e(a),a.options.container}};var k=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),l=Object.getOwnPropertyDescriptor,m=function(a,b){for(var c in b)b.hasOwnProperty(c)&&k(a,c,l(b,c));return a},n=function(){"use strict";function a(a){this._plugins=a}var b={};return k(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b._call=function(a,b){for(var c=0;c<this._plugins.length;c++)"function"==typeof this._plugins[c][a]&&this._plugins[c][a].apply(this._plugins[c],b)},b.render=function(){this._call("render",arguments)},b.click=function(){this._call("click",arguments)},b.mouseover=function(){this._call("mouseover",arguments)},b.mouseout=function(){this._call("mouseout",arguments)},b.mousemove=function(){this._call("mousemove",arguments)},m(a.prototype,b),b=void 0,a}(),o=function(a){return function(){this.on("click",function(b){a.click(new q(b),new p(d3.select(this)))}).on("mouseover",function(b){a.mouseover(new q(b),new p(d3.select(this)))}).on("mouseout",function(b){a.mouseout(new q(b),new p(d3.select(this)))}).on("mousemove",function(b){a.mousemove(new q(b),new p(d3.select(this)))})}},p=function(){"use strict";function a(a){this.element=a}return k(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),q=(function(){"use strict";function a(a){this.data=a}return k(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),function(){"use strict";function a(a){this.datum=a}return k(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}()),r=(function(){"use strict";function a(a,b){this.svg=a.svg,this.html=a.html,this.mapper=b}var b={};return k(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.elements=function(){return this.svg.selectAll(".i-role-datum")},m(a.prototype,b),b=void 0,a}(),function(){"use strict";function a(a){var b=this.convertConfig(a);if(b.spec.dimensions);else b.spec.dimensions=this._autoDetectDimensions(b.data);this.config=_.defaults(b,{spec:null,data:[],plugins:[]}),this.plugins=this.config.plugins,this.spec=this.config.spec,this.data=this.config.data,this.reader=new j(this.spec);var c=this._render(this.reader.traverse(this.data));this._chart=c.node(),this._plugins=new n(this.config.plugins),c.selectAll(".i-role-datum").call(o(this._plugins))}var b=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),c=Object.getOwnPropertyDescriptor,d=function(a,d){for(var e in d)d.hasOwnProperty(e)&&b(a,e,c(d,e));return a},e={};return b(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e._autoDetectDimensions=function(a){function b(a){return _.isNumber(a)?"linear":"ordinal"}return _.reduce(a,function(a,c){return _.each(c,function(c,d){a[d]?a[d].scaleType=a[d].scaleType==b(c)?"linear":"ordinal":a[d]={scaleType:b(c)}}),a},{})},e.convertConfig=function(a){return a},e._render=function(a){return this.reader.traverseToNode(a,this.data)},d(a.prototype,e),e=void 0,a}()),s=function(b){"use strict";function c(){b.apply(this,arguments)}var d=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),e=Object.defineProperty,f=Object.getOwnPropertyDescriptor,g=function(a,b){for(var c in b)b.hasOwnProperty(c)&&e(a,c,f(b,c));return a},h=Object.setPrototypeOf||function(a,b){return d?a.__proto__=b:e(a,"__proto__",{value:b,configurable:!0,enumerable:!1,writable:!0}),a},i=Object.create;d||g(c,b),null!==b&&h(c,b),c.prototype=i(null!==b?b.prototype:null,{constructor:{value:c,configurable:!0,writable:!0}}),e(c,"prototype",{configurable:!1,enumerable:!1,writable:!1});var j={};return j.convertConfig=function(b){var c=_.omit(b,"spec");return c.spec={dimensions:b.dimensions,H:b.height,W:b.width,container:b.container,unit:{axes:[a(b.x),a(b.y)],padding:{L:24,B:24,R:24,T:24},type:"COORDS.RECT",showGridLines:"xy",unit:[{type:"ELEMENT.POINT",x:b.x,y:b.y,color:b.color,size:b.size}]}},c},g(c.prototype,j),j=void 0,c}(r),t={Chart:r,Scatterplot:s};return t});