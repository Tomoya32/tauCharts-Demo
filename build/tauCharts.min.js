/*! tauCharts - v0.0.1 - 2014-10-07
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(a):"object"==typeof module&&module.exports?module.exports=a():this.tauChart=a()}(function(){var a=function(){var a=function(a,b){var c,d=_.toArray(arguments);c=_.isArray(d[0])?d[0]:_.times(a,function(){return _.times(b,function(){return null})}),this.cube=c};return a.prototype={iterate:function(a){var b=this.cube;return _.each(b,function(b,c){_.each(b,function(b,d){a(c,d,b)})}),this},getRC:function(a,b){return this.cube[a][b]},setRC:function(a,b,c){return this.cube[a][b]=c,this},sizeR:function(){return this.cube.length},sizeC:function(){var a=this.cube[0]||[];return a.length}},a}(),b=function(){var b=function(a,b){return function(c){return c[a]===b}},c=function(a){return JSON.parse(JSON.stringify(a))},d={CROSS:function(a,c,d){var e=a.domain(c),f=a.domain(d).reverse();return _(f).map(function(a){return _(e).map(function(e){return[b(c,e),b(d,a)]})})}},e=[],f={"COORDS/RECT":function(b,f){var g=_.defaults(b,{$filter:e});g.padding=_.defaults(g.padding||{},{L:0,B:0,R:0,T:0}),g.axes=_(g.axes).map(function(a,b){return _.defaults(a||{},{scaleOrient:0===b?"bottom":"left",padding:0})});var h=d[g.func]||function(){return[[e]]},i=new a(h(g,g.axes[0].scaleDim,g.axes[1].scaleDim)),j=new a(i.sizeR(),i.sizeC());return i.iterate(function(a,b,d){var e=g.$filter.concat(d),f=_(g.unit).map(function(a){return _.extend(c(a),{$filter:e})});j.setRC(a,b,f)}),g.$matrix=j,j.iterate(function(a,b,c){_.each(c,function(a){return f(a)})}),g}};return f["COORDS.RECT"]=f["COORDS/RECT"],function(a){return f[a]||function(a){return a.padding=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),a}}}(),c=function(){var a=function(a,b){return"translate("+a+","+b+")"},b=function(a){return"ordinal"===a?"rangeRoundBands":"rangeRound"},c=function(b,c,d){var e=this;b.scaleDim&&e.append("g").attr("class",d).attr("transform",a.apply(null,c)).call(d3.svg.axis().scale(b.scale).orient(b.scaleOrient))},d=function(b,c,d){var e=this,f=e.append("g").attr("class","grid").attr("transform",a(0,0)),g=(b.showGridLines||"").toLowerCase();if(g.length>0){var h=f.append("g").attr("class","grid-lines");if(g.indexOf("x")>-1&&b.axes[0]){var i=b.axes[0],j=d3.svg.axis().scale(i.scale).orient(i.scaleOrient).tickSize(c);h.append("g").call(j)}if(g.indexOf("y")>-1&&b.axes[1]){var k=b.axes[1],l=d3.svg.axis().scale(k.scale).orient(k.scaleOrient).tickSize(-d);h.append("g").call(l)}h.selectAll("text").remove()}return f},e=function(a){var b=a.$matrix.cube[0];return b&&b[0]&&b[0][0].axes&&b[0][0].axes[0]&&b[0][0].axes[0].bubble?{$scales:b[0][0].$scales,axes:b[0][0].axes}:{axes:[]}},f=function(a,c,d,e,f){c.append("g").attr("class","axes nest");var g=a,h=_.chain(d).map(function(a){return a[e.x]}).unique().value(),i=_.chain(d).map(function(a){return a[e.y]}).unique().value(),j=g.axes[0],k=g.$scales[j.scaleDim][b(j.scaleType)]([0,f.width-2*f.paddingX],.1);c.selectAll(".x.axis.nest").data(h).enter().append("g").attr("class","x axis nest").attr("transform",function(a,b){return"translate("+(b*f.width+f.paddingY)+","+f.containerHeight+")"}).each(function(){d3.select(this).call(d3.svg.axis().scale(k).orient("bottom"))});var l=g.axes[1],m=g.$scales[l.scaleDim][b(l.scaleType)]([f.height-2*f.paddingY,0],.1);c.selectAll(".y.axis.nest").data(i).enter().append("g").attr("class","y axis nest").attr("transform",function(a,b){return"translate(0,"+(b*f.height+f.paddingY/2)+")"}).each(function(){d3.select(this).call(d3.svg.axis().scale(m).orient("left"))})},g={"COORDS/RECT":function(c,d){var g=c.options||{},h=c.axes,i=_.defaults(h[0]||{},{scaleOrient:"bottom"}),j=_.defaults(h[1]||{},{scaleOrient:"left"}),k=36,l=18,m=5,n=5,o=e(c),p=o.axes.length;i.bubble===!0&&j.bubble===!0?(k=m,l=n):p&&(k=56,l=30);var q,r=g.width-2*k,s=g.height-2*l,t=g.container.append("g").attr("class","cell").attr("transform",a(g.left+k,g.top+l/2));if(i.scaleDim&&(q=c.$scales[i.scaleDim][b(i.scaleType)]([0,r],.1),i.bubble!==!0)){var u=d3.svg.axis().scale(q).orient(i.scaleOrient);t.append("g").attr("class","x axis nest").attr("transform",a(0,s+25)).call(u)}var v;if(j.scaleDim&&(v=c.$scales[j.scaleDim][b(j.scaleType)]([s,0],.1),j.bubble!==!0)){var w=d3.svg.axis().scale(v).orient(j.scaleOrient);t.append("g").attr("class","y axis").attr("transform",a(-25,0)).call(w)}if(c.showGrid){var x=t.insert("g",":first-child").attr("class","grids");if(q){var y=d3.svg.axis().scale(q).orient(i.scaleOrient).tickSize(s);x.append("g").call(y)}if(v){var z=d3.svg.axis().scale(v).orient(j.scaleOrient).tickSize(-r);x.append("g").call(z)}x.selectAll("text").remove()}var A=t.append("g").attr("class","grid").attr("transform",a(0,0)),B=c.$matrix.sizeR(),C=c.$matrix.sizeC(),D=r/C,E=s/B;p&&f(o,t,c.partition(),{x:i.scaleDim,y:j.scaleDim},{width:D,height:E,containerHeight:s,paddingX:m,paddingY:n}),c.$matrix.iterate(function(a,b,c){c.forEach(function(c){c.options={container:A,width:D,height:E,top:a*E,left:b*D,xScale:q,yScale:v},d(c)})})},"COORDS.RECT":function(b,e){var f=b.options||{},g=_(b.axes).map(function(a,b){var c=_.isArray(a)?a:[a];return c[0]=_.defaults(c[0]||{},{scaleOrient:0===b?"bottom":"left",padding:0}),c}),h=g[0][0],i=g[1][0],j=_.defaults(b.padding||{},{L:0,B:0,R:0,T:0}),k=f.left+j.L,l=f.top+j.T,m=f.width-(j.L+j.R),n=f.height-(j.T+j.B),o=h.scaleDim&&b.scaleTo(h,[0,m]),p=i.scaleDim&&b.scaleTo(i,[n,0]);g[0][0].scale=o,g[1][0].scale=p;var q=[0,n+h.padding],r=[0-i.padding,0],s=f.container.append("g").attr("class","cell").attr("transform",a(k,l));h.hide||c.call(s,h,q,"x axis"),i.hide||c.call(s,i,r,"y axis");var t=d.call(s,b,n,m);b.$matrix.iterate(function(a,b,c){c.forEach(function(a){a.options=_.extend({container:t},a.options||{}),e(a)})})},"ELEMENT/POINT":function(a){var b=a.partition(),c=a.source(),d=a.options||{};d.xScale=a.scaleTo(a.x,[0,d.width]),d.yScale=a.scaleTo(a.y,[d.height,0]);var e=d3.scale.ordinal().range(["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"]).domain(_(c).chain().pluck(a.color).uniq().value()),f=d3.scale.linear().range([0,d.width/100]).domain([0,_(c).chain().pluck(a.size).max().value()]),g=function(){return this.attr("r",function(b){var c=f(b[a.size]);return _.isNaN(c)&&(c=d.width/100),c}).attr("class",function(b){return"dot i-role-datum "+e(b[a.color])}).attr("cx",function(b){return d.xScale(b[a.x])}).attr("cy",function(b){return d.yScale(b[a.y])})},h=d.container.selectAll(".dot").data(b);h.call(g),h.exit().remove(),h.enter().append("circle").call(g)},"ELEMENT/INTERVAL":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=function(){return this.attr("class","i-role-datum  bar").attr("x",function(c){return b.xScale(c[a.x])}).attr("width",b.xScale.rangeBand()).attr("y",function(c){return b.yScale(c[a.y])}).attr("height",function(c){return b.height-b.yScale(c[a.y])})},d=b.container.selectAll(".bar").data(a.partition());d.call(c),d.enter().append("rect").call(c),d.exit().remove()},"ELEMENT/LINE":function(a){var b=a.options||{};b.xScale=a.scaleTo(a.x,[0,b.width]),b.yScale=a.scaleTo(a.y,[b.height,0]);var c=d3.svg.line().x(function(c){return b.xScale(c[a.x])}).y(function(c){return b.yScale(c[a.y])});b.container.append("g").attr("class","line").attr("stroke","#4daf4a").append("path").datum(a.partition()).attr("d",c)},"WRAP.AXIS":function(b,d){var e=b.options||{},f=_(b.axes).map(function(a,b){var c=_.isArray(a)?a:[a];return c[0]=_.defaults(c[0]||{},{scaleOrient:0===b?"bottom":"left",padding:0}),c}),g=f[0][0],h=f[1][0],i=_.defaults(b.padding||{},{L:0,B:0,R:0,T:0}),j=e.left+i.L,k=e.top+i.T,l=e.width-(i.L+i.R),m=e.height-(i.T+i.B),n=g.scaleDim&&b.scaleTo(g,[0,l]),o=h.scaleDim&&b.scaleTo(h,[m,0]);f[0][0].scale=n,f[1][0].scale=o;var p=[0,m+g.padding],q=[0-h.padding,0],r=e.container.append("g").attr("class","axis-container").attr("transform",a(j,k));e.showX&&!g.hide&&c.call(r,g,p,"x axis"),e.showY&&!h.hide&&c.call(r,h,q,"y axis");{var s=r.append("g").attr("class","sub-axis-container").attr("transform",a(0,0)),t=b.$axes.sizeR();b.$axes.sizeC()}b.$axes.iterate(function(a,b,c){(0===b||a===t-1)&&c.forEach(function(c){c.options=_.extend({container:s,showX:a===t-1,showY:0===b},c.options||{}),c.$axes&&d(c)})})},"WRAP.MULTI_AXES":function(b,c){var e=b.options||{},f=b.padding,g=e.left+f.L,h=e.top+f.T,i=e.width-(f.L+f.R),j=e.height-(f.T+f.B),k=e.container.append("g").attr("class","cell-wrapper").attr("transform",a(g,h));b.$axes.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:k,showX:!0,showY:!0},a.options||{}),c(a)})});var l=d.call(k,b,j,i);b.$matrix.iterate(function(a,b,d){d.forEach(function(a){a.options=_.extend({container:l},a.options||{}),c(a)})})}};return g["COORDS/RECT"]=g["COORDS.RECT"],function(a){if(!g.hasOwnProperty(a))throw new Error("Unknown unit type: "+a);return g[a]}}(),d={ordinal:function(a){return a},linear:function(a){return d3.extent(a)}},e=function(a){return"ordinal"===a?"rangeRoundBands":"rangeRound"},f=function(a,b){return _.every(a,function(a){return a(b)})},g=function(a,b,c){return a.source=function(a){return _(c).filter(a||function(){return!0})},a.partition=function(){return a.source(f.bind(null,a.$filter))},a.domain=function(a){return _(c).chain().pluck(a).uniq().value()},a.scaleTo=function(c,f){var g=_.isString(c)?{scaleDim:c}:c,h=_.defaults(g,b[g.scaleDim]),i=h.scaleType,j=a.domain(h.scaleDim);return d3.scale[i]().domain(d[i](j))[e(i)](f,.1)},a},h=function(a){var b=_.omit(a,"$matrix");return JSON.parse(JSON.stringify(b))},i=function(a){this.ast=a};i.prototype={traverse:function(c,d){var e=this.ast.dimensions,f=function(a){if(!a.$axes)return a;var b=a.options||{},c=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),d=b.width-(c.L+c.R),e=b.height-(c.T+c.B),g=a.$axes.sizeR(),h=a.$axes.sizeC(),i=d/h,j=e/g;return a.$axes.iterate(function(a,b,c){c.forEach(function(c){c.options={width:i,height:j,top:a*j,left:b*i},f(c)})}),a},i=function(b){var d=function(b,c){if(!b.$matrix)return b;_.each(b.axes,function(a){return a.hide=!0});var e=b.$matrix.sizeR(),f=b.$matrix.sizeC();return c.$axes=new a(e,f),b.$matrix.iterate(function(a,b,e){var f=[];c.$axes.setRC(a,b,f),e.forEach(function(a){if(a.$matrix){var b=_.extend(h(a),{type:"WRAP.AXIS"});f.push(b),d(a,b)}})}),b},f={type:"WRAP.MULTI_AXES",padding:{L:0,R:0,T:0,B:0},options:h(b.options),$matrix:new a([[[b]]])};return d(g(f,e,c),f)},j=d||function(a){if(!a.$matrix)return a;var b=a.options||{},c=_.defaults(a.padding||{},{L:0,B:0,R:0,T:0}),d=b.width-(c.L+c.R),e=b.height-(c.T+c.B),f=a.$matrix.sizeR(),g=a.$matrix.sizeC(),h=d/g,i=e/f;return a.$matrix.iterate(function(a,b,c){c.forEach(function(c){c.options={width:h,height:i,top:a*i,left:b*h},j(c)})}),a},k=function(a){return b(a.type)(g(a,e,c),k)},l=this.ast.unit;return l.options={width:this.ast.W,height:this.ast.H,top:0,left:0},j(f(i(k(l))))},traverseToNode:function(a,b){var d=this.ast.dimensions;this.container=d3.select(this.ast.container).append("svg").style("border","solid 1px").attr("width",this.ast.W).attr("height",this.ast.H),a.options.container=this.container;var e=function(a){return c(a.type)(g(a,d,b),e)};return e(a),a.options.container}};var j=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),k=Object.getOwnPropertyDescriptor,l=function(a,b){for(var c in b)b.hasOwnProperty(c)&&j(a,c,k(b,c));return a},m=function(){"use strict";function a(a){this._plugins=a}var b={};return j(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b._call=function(a,b){for(var c=0;c<this._plugins.length;c++)"function"==typeof this._plugins[c][a]&&this._plugins[c][a].apply(this._plugins[c],b)},b.render=function(){this._call("render",arguments)},b.click=function(){this._call("click",arguments)},b.mouseover=function(){this._call("mouseover",arguments)},b.mouseout=function(){this._call("mouseout",arguments)},b.mousemove=function(){this._call("mousemove",arguments)},l(a.prototype,b),b=void 0,a}(),n=function(a){return function(){this.on("click",function(b){a.click(new p(b),new o(d3.select(this)))}).on("mouseover",function(b){a.mouseover(new p(b),new o(d3.select(this)))}).on("mouseout",function(b){a.mouseout(new p(b),new o(d3.select(this)))}).on("mousemove",function(b){a.mousemove(new p(b),new o(d3.select(this)))})}},o=function(){"use strict";function a(a){this.element=a}return j(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),p=(function(){"use strict";function a(a){this.data=a}return j(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),function(){"use strict";function a(a){this.datum=a}return j(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}()),q=(function(){"use strict";function a(a,b){this.svg=a.svg,this.html=a.html,this.mapper=b}var b={};return j(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.elements=function(){return this.svg.selectAll(".i-role-datum")},l(a.prototype,b),b=void 0,a}(),function(){"use strict";function a(a){this.config=_.defaults(a,{spec:null,data:[],plugins:[]}),this.plugins=this.config.plugins,this.spec=this.config.spec,this.data=this.config.data,this.reader=new i(this.spec);var b=this._render(this.reader.traverse(this.data));this._chart=b.node(),this._plugins=new m(this.config.plugins),b.selectAll(".i-role-datum").call(n(this._plugins))}var b=(function(a,b){return a.__proto__={a:b},a.a===b}({},{}),Object.defineProperty),c=Object.getOwnPropertyDescriptor,d=function(a,d){for(var e in d)d.hasOwnProperty(e)&&b(a,e,c(d,e));return a},e={};return b(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e._render=function(a){return this.reader.traverseToNode(a,this.data)},e.getSvg=function(){return this._chart},d(a.prototype,e),e=void 0,a}()),r={Chart:q};return r});