/*! tauCharts - v0.0.1 - 2014-03-28
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed MIT */
!function(){var a=function(){};a.new=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c},a.extend=function(a){function b(){!d&&this.init&&this.init.apply(this,arguments)}var c=this.prototype,d=!0,e=new this;d=!1;for(var f in a)e[f]="function"==typeof a[f]&&"function"==typeof c[f]?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}}(f,a[f]):a[f];return b.prototype=e,b.prototype.constructor=b,b.extend=arguments.callee,b},window.Class=a,window.tau={}}(),function(){var a=Class.extend({init:function(a){this._plugins=a},_call:function(a,b){for(var c=0;c<this._plugins.length;c++)"function"==typeof this._plugins[c][a]&&this._plugins[c][a].apply(this._plugins[c],b)},render:function(){this._call("render",arguments)},click:function(){this._call("click",arguments)},mouseover:function(){this._call("mouseover",arguments)},mouseout:function(){this._call("mouseout",arguments)}}),b=Class.extend({init:function(a){this._dataSource=a},map:function(a){return this._mapper=tau.data.Mapper(a),this},plugins:function(){return this._plugins=new a(arguments),this},render:function(){throw new Error("Not implemented")}}),c={padding:10},d=Class.extend({init:function(a){this._mapper=a},render:function(){}}),e=d.extend({render:function(a){var b=d3.svg.axis().scale(this._mapper._scale).orient("bottom");a.append("g").attr("class","x axis").attr("transform","translate(0, "+c.padding+")").call(b).append("text").attr("class","label").attr("x",a.layout("width")).attr("y",-b.tickSize()).style("text-anchor","end").text(this._mapper.caption())}}),f=d.extend({render:function(a){var b=d3.svg.axis().scale(this._mapper._scale).orient("left");a.append("g").attr("class","y axis").attr("transform","translate(-"+c.padding+", 0)").call(b).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",b.tickSize()).attr("y",b.tickSize()+a.layout("width")).attr("dy",".71em").style("text-anchor","end").text(this._mapper.caption()),a.selectAll(".tick line").attr("x1",a.layout("width")-6).attr("x2",a.layout("width")),a.selectAll(".tick text").attr("dx",a.layout("width")),a.select(".domain").attr("transform","translate("+a.layout("width")+", 0)")}}),g=Class.extend({init:function(a,b){this._mapperX=a,this._mapperY=b},render:function(a){var b=d3.svg.axis().scale(this._mapperX._scale).orient("bottom").tickSize(a.layout("height")),c=d3.svg.axis().scale(this._mapperY._scale).orient("left").tickSize(-a.layout("width")),d=a.insert("g",":first-child").attr("class","grid");d.append("g").call(b),d.append("g").call(c),d.selectAll("text").remove()}}),h={top:20,right:20,bottom:30,left:40},i='<div class="html html-left"></div><svg></svg><div class="html html-right"></div><div class="html html-above"></div><div class="html html-below"></div>',j=Class.extend({init:function(a){var b=d3.select(a).classed("tau-chart",!0).html(i);this.html={left:b.select(".html-left"),right:b.select(".html-right"),above:b.select(".html-above"),below:b.select(".html-below")},this.svg=tau.svg.paddedBox(b.select("svg"),h);var c=new tau.svg.Layout(this.svg);c.row(-30),this.yAxis=c.col(20),this.data=c.col(),c.row(),c.col(20),this.xAxis=c.col(),this.width=this.data.layout("width"),this.height=this.data.layout("height")}}),k=function(a){return function(){this.on("click",function(b){a.click(new p(b),new n(d3.select(this)))}).on("mouseover",function(b){a.mouseover(new p(b),new n(d3.select(this)))}).on("mouseout",function(b){a.mouseout(new p(b),new n(d3.select(this)))})}},l=b.extend({init:function(a){this._super.call(this,a)},_renderData:function(){throw new Error("Not implemented")},render:function(a){var b=new j(a);this._mapper.binder("x").range([0,b.width]),this._mapper.binder("y").range([b.height,0]),this._dataSource.get(function(a){this._mapper.binder("x").domain([0,d3.max(a,this._mapper.raw("x"))]),this._mapper.binder("y").domain([0,d3.max(a,this._mapper.raw("y"))]);var c=function(a){this._renderData(b.data,a),b.data.selectAll(".i-role-datum").call(k(this._plugins))}.bind(this);c(a),this._dataSource.update(c),new f(this._mapper.binder("y")).render(b.yAxis),new e(this._mapper.binder("x")).render(b.xAxis),new g(this._mapper.binder("x"),this._mapper.binder("y")).render(b.data),tau.svg.bringOnTop(b.data),this._plugins.render(new o(this._dataSource),new m(b,this._mapper))}.bind(this))}}),m=Class.extend({init:function(a,b){this.svg=a.svg,this.html=a.html,this.mapper=b},elements:function(){return this.svg.selectAll(".i-role-datum")}}),n=Class.extend({init:function(a){this.element=a}}),o=Class.extend({init:function(a){this.data=a}}),p=Class.extend({init:function(a){this.datum=a}});tau.charts={Base:l,add:function(a,b){tau.charts[a]=b}}}(),function(){var a=function(a,b,c){return a[b]=c,a},b=function(b,c){return a({},b,c)},c=function(){},d=function(a,b){return function(){a.apply(a,arguments),b.apply(b,arguments)}},e=Class.extend({init:function(){this._observers={update:c}},get:function(){throw new Error("not implemented")},filter:function(){throw new Error("not implemented")},update:function(a){this._on("update",a)},_on:function(a,b){this._observers[a]=d(this._observers[a],b)},_trigger:function(a,b){this._observers[a](b)}}),f=e.extend({init:function(a){this._data=a,this._super()},get:function(a){a(this._predicate?this._data.filter(this._predicate):this._data)},filter:function(a){this._predicate=a,this._trigger("update",this._predicate?this._data.filter(this._predicate):this._data)}}),g=Class.extend({init:function(a){this._propertyMappers=a},binder:function(a){return this._propertyMappers[a]},domain:function(a){return this.binder(a).domain()},_bind:function(a,b,c){var d=/%[^%]*%/g;return d.test(a)?function(e){return a.replace(d,function(a){var d=a.substr(1,a.length-2);return b.call(c,d,e)})}:function(d){return b.call(c,a,d)}},map:function(a){return this._bind(a,function(a,b){return this.binder(a).map(b)},this)},raw:function(a){return this._bind(a,function(a,b){return this.binder(a).raw(b)},this)},alias:function(a,b){this._propertyMappers[a].alias(b)}}),h=Class.extend({init:function(a){this._names=[a],this._caption=a,this._scale=d3.scale.linear()},alias:function(a){this._names.push(a)},raw:function(a){return a[this._names.filter(function(b){return a.hasOwnProperty(b)})[0]]},map:function(a){return this._scale(this.raw(a))},linear:function(){return this._scale=d3.scale.linear(),this},domain:function(){return arguments.length?this._scale.domain.apply(this._scale.domain,arguments):this._scale.domain().map(b.bind(null,this._names[0]))},category10:function(){return this._scale=d3.scale.ordinal().range(["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"]),this},range:function(){return this._scale.range.apply(this._scale,arguments),this},caption:function(a){return a?(this._caption=a,this):this._caption}}),i=Class.extend({init:function(a){this._value=a},raw:function(){return this._value},map:function(){return this._value},domain:function(){},range:function(){throw new Error("range is not implemented for constants")},caption:function(){throw new Error("caption is not implemented for constants")}});tau.data={Array:function(a){return new f(a)},Mapper:function(a){function b(){var b={};for(var c in a){var d=a[c];"string"==typeof d&&(d=new h(d)),b[c]=d}return b}return new g(b())},map:function(a){return new h(a)},constant:function(a){return new i(a)},identity:function(a){return a}}}(),function(){var a=Class.extend({init:function(){},render:function(){},click:function(){},mouseover:function(){},mouseout:function(){}});tau.plugins={add:function(b,c){c=a.extend(c),tau.plugins[b]=function(){return Class.new(c,arguments)}}}}(),function(){function a(a,b){return a>0?a:b+a}var b=Class.extend({init:function(a,b){this._svg=a,b?(this._width=b.width,this._height=b.height):(this._width=a.layout("width"),this._height=a.layout("height")),this._x=0,this._y=0,this._translateX=0,this._translateY=0},_translate:function(a){(this._translateX||this._translateY)&&a.attr("transform","translate("+(this._translateX||0)+","+(this._translateY||0)+")")},_extend:function(b){var c={width:a(this._x-this._translateX,this._width),height:a(this._y-this._translateY,this._height)};b.layout=function(a){return c[a]}},row:function(b){this._translateX=0,this._translateY=this._y,this._y=b?this._y+a(b-this._y,this._height):null},col:function(b){return this._translateX=this._x,this._x=b?this._x+a(b-this._x,this._width):null,this._svg.append("g").call(this._translate.bind(this)).call(this._extend.bind(this))}}),c=function(a){a.node().parentNode.appendChild(a.node())},d=function(a,b){var c=a[b].baseVal;switch(c.unitType){case 1:return c.value;case 2:return(a.parentNode[b]||a.parentNode.getBoundingClientRect()[b])*c.valueInSpecifiedUnits/100;default:throw new Error("unitType "+c.unitType+" is not supported")}},e=function(a){return{width:d(a,"width"),height:d(a,"height")}},f=function(a,b){var c=new tau.svg.Layout(a,e(a.node()));return c.row(b.top),c.row(-b.bottom),c.col(b.left),c.col(-b.right)};tau.svg={getBBox:e,bringOnTop:c,paddedBox:f,Layout:b}}(),function(){var a=tau.charts.Base.extend({map:function(a){return this._super(a),this._mapper.alias("color","key"),this},_renderData:function(a,b){var c=this._mapper,d=d3.nest().key(c.raw("color")).entries(b),e=function(){this.attr("class",c.map("line %color%"));var a=this.selectAll("path").data(function(a){return[a.values]});a.call(g),a.enter().append("path").call(g),a.exit().remove();var b=this.selectAll(".dot").data(function(a){return a.values});b.call(h),b.enter().append("circle").attr("class","dot i-role-datum").call(h),b.exit().remove()},f=d3.svg.line().interpolate("cardinal").x(c.map("x")).y(c.map("y")),g=function(){this.attr("d",f)},h=function(){return this.attr("cx",c.map("x")).attr("cy",c.map("y")).attr("r",function(){return 3})},i=a.selectAll(".line").data(d);i.call(e),i.enter().append("g").call(e),i.exit().remove()}});tau.charts.add("Line",function(b){return new a(b)})}(),function(){var a=tau.charts.Base.extend({_renderData:function(a,b){this._mapper.binder("size").domain(d3.extent(b,this._mapper.raw("size")));var c=this._mapper,d=function(){return this.attr("class",c.map("dot i-role-datum %color%")).attr("r",c.map("size")).attr("cx",c.map("x")).attr("cy",c.map("y"))},e=a.selectAll(".dot").data(b);e.call(d),e.enter().append("circle").call(d),e.exit().remove()}});tau.charts.add("Scatterplot",function(b){return new a(b)})}(),function(){var a={render:function(a,b){var c=b.html.right.append("div").attr("class","datatable");c.append("a").attr("href","#").html("Show data table").on("click",function(){e(),f(c),d3.event.preventDefault()});var d=c.append("div"),e=function(){var b=d.append("table"),c=b.append("thead"),f=b.append("tbody"),g=Object.keys(a.data._data[0]);b.attr("class",function(){return"col-"+g.length}),c.selectAll("th").data(g).enter().append("th").text(tau.data.identity);var h=f.selectAll("tr").data(a.data._data).enter().append("tr");h.selectAll("td").data(function(a){return d3.values(a)}).enter().append("td").text(function(a){return a}),e=function(){}},f=function(a){"datatable"==a.attr("class")?a.attr("class","datatable show"):a.attr("class","datatable")}}};tau.plugins.add("datatable",a)}(),function(){var a={init:function(){this._header=arguments[0],this._description=arguments[1]},render:function(a,b){var c=this._header,d=this._description,e=b.html.above.append("header").attr("class","title");e.append("h1").html(c),e.append("p").html(d)}};tau.plugins.add("header",a)}(),function(){var a={mouseover:function(a,b){b.element.classed("highlighted",!0)},mouseout:function(a,b){b.element.classed("highlighted",!1)}};tau.plugins.add("highlighter",a)}(),function(){function a(a){return function(b){return a!=b}}var b={render:function(b,c){var d=(c.svg.layout("width"),c.mapper.domain("color")),e=[],f=c.html.right.append("ul").attr("class","legend"),g=f.selectAll("li").data(d).enter().append("li");g.attr("class",c.mapper.map("color")).on("click",function(d){var f=c.mapper.raw("color")(d);-1==e.indexOf(f)?(e.push(f),d3.select(this).classed("disabled",!0)):(e=e.filter(a(f)),d3.select(this).classed("disabled",!1)),b.data.filter(function(a){return-1==e.indexOf(c.mapper.raw("color")(a))})}).on("mouseover",function(a){var b=c.mapper.raw("color")(a);c.elements().classed("highlighted",function(a){return c.mapper.raw("color")(a)===b})}).on("mouseout",function(){c.elements().classed("highlighted",!1)}),g.text(c.mapper.raw("color"))}};tau.plugins.add("legend",b)}(),function(){var a={init:function(){this._axises=0===arguments.length?["x","y"]:Array.prototype.slice.call(arguments,0)},render:function(a,b){var c=20,d=30,e=10,f=(b.svg.layout("width"),b.svg.layout("height")),g=b.mapper,h=this._axises;this.mouseover=function(a){var i=b.svg.selectAll(".projections").data([a.datum]).enter().append("g").attr("transform","translate("+c+", 0)").attr("class",g.map("color")).classed("projections",!0);h.indexOf("x")>-1&&(i.append("g").attr("class","y").append("line").attr("x1",g.map("x")).attr("y1",f-d+e).attr("x2",g.map("x")).attr("y2",g.map("y")),i.select(".y").append("text").attr("transform","translate(0, 18)").attr("dx",g.map("x")).attr("dy",f-d+10).text(g.raw("x"))),h.indexOf("y")>-1&&(i.append("g").attr("class","x").append("line").attr("x1",0).attr("y1",g.map("y")).attr("x2",g.map("x")).attr("y2",g.map("y")),i.select(".x").append("text").attr("transform","translate(-19, 4)").attr("dx",0).attr("dy",g.map("y")).text(g.raw("y")))},this.mouseout=function(){b.svg.selectAll(".projections").remove()}}};tau.plugins.add("projection",a)}(),function(){var a={init:function(){this._dataFields=arguments,this._container=d3.select("body").append("div")},mouseover:function(a){for(var b="",c=this._dataFields.length-1;c>=0;c--){var d=this._dataFields[c];b+='<p class="tooltip-'+d+'"><em>'+d+":</em> "+a.datum[d]+"</p>"}this._container.classed("tooltip",!0).style("top",d3.mouse(this._container[0].parentNode)[1]-10+"px").style("left",d3.mouse(this._container[0].parentNode)[0]+10+"px").style("display","block").html(b)},mouseout:function(){this._container.style("display","none")}};tau.plugins.add("tooltip",a)}();